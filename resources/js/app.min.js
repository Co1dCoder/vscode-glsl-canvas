!function(){"use strict";var t=function(){function t(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}return t.prototype={negative:function(){return new t(-this.x,-this.y,-this.z)},add:function(e){return e instanceof t?new t(this.x+e.x,this.y+e.y,this.z+e.z):new t(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof t?new t(this.x-e.x,this.y-e.y,this.z-e.z):new t(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof t?new t(this.x*e.x,this.y*e.y,this.z*e.z):new t(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof t?new t(this.x/e.x,this.y/e.y,this.z/e.z):new t(this.x/e,this.y/e,this.z/e)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(t){return Math.acos(this.dot(t)/(this.length()*t.length()))},toArray:function(t){return[this.x,this.y,this.z].slice(0,t||3)},clone:function(){return new t(this.x,this.y,this.z)},init:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},t.negative=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},t.add=function(e,n,r){return n instanceof t?(r.x=e.x+n.x,r.y=e.y+n.y,r.z=e.z+n.z):(r.x=e.x+n,r.y=e.y+n,r.z=e.z+n),r},t.subtract=function(e,n,r){return n instanceof t?(r.x=e.x-n.x,r.y=e.y-n.y,r.z=e.z-n.z):(r.x=e.x-n,r.y=e.y-n,r.z=e.z-n),r},t.multiply=function(e,n,r){return n instanceof t?(r.x=e.x*n.x,r.y=e.y*n.y,r.z=e.z*n.z):(r.x=e.x*n,r.y=e.y*n,r.z=e.z*n),r},t.divide=function(e,n,r){return n instanceof t?(r.x=e.x/n.x,r.y=e.y/n.y,r.z=e.z/n.z):(r.x=e.x/n,r.y=e.y/n,r.z=e.z/n),r},t.cross=function(t,e,n){return n.x=t.y*e.z-t.z*e.y,n.y=t.z*e.x-t.x*e.z,n.z=t.x*e.y-t.y*e.x,n},t.unit=function(t,e){var n=t.length();return e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e},t.fromAngles=function(e,n){return new t(Math.cos(e)*Math.cos(n),Math.sin(n),Math.sin(e)*Math.cos(n))},t.randomDirection=function(){return t.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},t.min=function(e,n){return new t(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.min(e.z,n.z))},t.max=function(e,n){return new t(Math.max(e.x,n.x),Math.max(e.y,n.y),Math.max(e.z,n.z))},t.lerp=function(t,e,n){return e.subtract(t).multiply(n).add(t)},t.fromArray=function(e){return new t(e[0],e[1],e[2])},t.angleBetween=function(t,e){return t.angleTo(e)},t}();window.Vector=t}(),function(){"use strict";var t=function(){var t=Math.PI/180;function e(e,n,r){this.theta=(e||45)*t,this.phi=(n||45)*t,this.radius=r||1}return e.prototype={down:function(t,e){this.mouse={x:t,y:e}},move:function(e,n){var r=this.mouse;if(r){var i=180*(e-r.x)*t,o=180*(r.y-n)*t;r.x=e,r.y=n,this.theta+=i,this.phi+=o}},up:function(t,e){this.mouse=null},wheel:function(t){this.radius=Math.max(.01,this.radius+.02*t)},render:function(t){var n=e.toVector(this),r=new Float32Array([n.x,n.y,n.z]);this.update(t,"3fv","vec3","u_camera",r)},update:function(t,e,n,r,i){try{var o=t.uniforms[r]=t.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+e,o.location=t.gl.getUniformLocation(t.program,r),t.gl[o.method].apply(t.gl,[o.location].concat(o.value))}catch(t){console.log("fastUpdate",t)}}},e.fromVector=function(t){var n=t.length(),r=Math.acos(t.y/n),i=Math.atan(t.x/t.z);return new e(r,i,n)},e.toVector=function(t){var e=Math.sin(t.phi)*t.radius,n=e*Math.sin(t.theta),r=Math.cos(t.phi)*t.radius,i=e*Math.cos(t.theta);return new Vector(n,r,i)},e}();window.CameraService=t}(),function(){"use strict";function t(){}t.prototype={set:function(t){this.canvas=t},snapshot:function(){var t=this;if(t.queue)return t.queue.promise;return t.queue={},t.queue.promise=new Promise(function(e,n){t.queue.resolve=e,t.queue.reject=n}),t.queue.promise},snapshotRender:function(){if(this.queue){for(var t=this.canvas.toDataURL("image/png"),e=atob(t.slice(22)),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);var i=new Blob([n],{type:"image/png"});this.queue.resolve({blob:i,extension:".png"}),this.queue=null}},record:function(){var t=this;if("function"!=typeof window.MediaRecorder||!t.canvas||"function"!=typeof t.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(t.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var e={},n=[],r=t.canvas.captureStream(),i={mimeType:"video/webm"},o=new MediaRecorder(r,i);o.ondataavailable=function(o){if(o.data.size>0&&n.push(o.data),e.resolve){var s=new Blob(n,{type:i.mimeType});if(r){var a=r.getTracks()||[];a.forEach(function(t){t.stop(),r.removeTrack(t)})}r=null,t.recorder=null,t.capture=null,e.resolve({blob:s,extension:".webm"})}},t.capture=e,t.recorder=o,o.start()}catch(e){return t.capture=null,t.recorder=null,console.log("error: Scene video capture failed",e),!1}return!0},stop:function(){var t=this;if(!t.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return t.capture.promise=new Promise(function(e,n){t.capture.resolve=e,t.capture.reject=n}),t.recorder.stop(),t.capture.promise}},window.CaptureService=t}(),function(){"use strict";var t=function(){function t(t){var e={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]}[t.length],n={};return t.filter(function(t,r){n[e[r]]=t}),n}function e(t,e){var n={};return t.filter(function(t,r){n[e+r]=t}),n}function n(t){return function(e){return t[e]}}return{set:function(n){var r={};for(var i in n){var o=n[i];if(Array.isArray(o))if(o.length>1)switch(typeof o[0]){case"number":o.length<5&&(r[i]=t(o));break;case"boolean":r[i]=e(o,"bool_");break;case"string":r[i]=e(o,"texture_");break;case"object":r[i]=e(o,"struct_")}else o.length&&(r[i]=o[0]);else null!=o&&(r[i]=o)}return r},get:function(t){var e={};for(var r in t){var i=t[r];switch(typeof i){case"function":break;case"number":case"boolean":case"string":e[r]=i;break;default:var o=Object.keys(i);e[r]=o.map(n(i))}}return e}}}(),e=function(){function e(t){this.closed=!0,this.hidden=!0,this.callback=t||function(){console.log("GuiService.onChange")},this.pool={}}function n(t){return JSON.parse(JSON.stringify(t))}return e.prototype={load:function(e){var r=this,i=r.gui,o=r.locals,s=(a=e,u=o,JSON.stringify(a)!==JSON.stringify(u));var a,u;i&&s&&(r.closed=i.closed,i.destroy(),i=null);i||((i=new dat.GUI).closed=r.closed,r.gui=i,r.hidden?r.hide():r.show());if(s){o=n(e),r.locals=o;var c=t.set(e);c=function(t,e){t&&function t(e,n){for(var r in e)n.hasOwnProperty(r)&&("number"==typeof e[r]?e[r]=n[r]:"object"==typeof e[r]&&Object.keys(e[r]).length>0&&t(e[r],n[r]))}(t=n(t),e);return t}(c,r.pool),r.pool=c;var l=function(){r.callback(c)};!function t(e,n,r){var i,o=[];for(i in n)o.push(i);o.filter(function(o){var s=n[o];if("number"==typeof s)(i=e.add(n,o,0,1)).onChange(r);else if("object"==typeof s&&Object.keys(s).length>0){i=null;var a=e.addFolder(o);t(a,s,r)}else(i=e.add(n,o)).onChange(r)})}(i,c,l),c.randomize=function(){!function(t,e,n){(function t(e,n){e.__controllers.filter(function(t){if("number"==typeof t.initialValue&&"number"==typeof t.__min&&"number"==typeof t.__max){var e=t.__min+(t.__max-t.__min)*Math.random();n[t.property]=e,t.updateDisplay()}});for(var r in e.__folders)t(e.__folders[r],n[r])})(t,e),n()}(i,c,l)},i.add(c,"randomize")}else r.callback(r.pool)},hide:function(){this.hidden=!0;var t=this.gui;t&&(t.domElement.style.display="none")},show:function(){var t=this.locals,e=this.gui;e&&Object.keys(t).length&&(e.domElement.style.display="");this.hidden=!1},uniforms:function(){var e=this.pool;return t.get(e)}},e}();window.GuiService=e}(),function(){"use strict";var t=function(){function t(){this.mouse=new Float32Array([0,0]),this.history=[],this.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}t.prototype={render:function(t){var e=this.trails,n=this.history,r=this.mouse,i=0,o=e.length,s=n.length?n[0]:r;for(;i<o;){var a=i>0?e[i-1]:s,u=e[i],c=1/(5+i);u[0]+=(a[0]-u[0])*c,u[1]+=(a[1]-u[1])*c,this.update(t,"2fv","vec2","u_trails["+i+"]",u),i++}n.length&&n.shift()},move:function(t,e){var n=this.mouse;n[0]=t,n[1]=e,this.push()},push:function(t,n,r){var i,o,s,a=null,u=0;r||(r={});var c=function(){u=!1===r.leading?0:e(),a=null,s=t.apply(i,o),a||(i=o=null)};return function(){var l=e();u||!1!==r.leading||(u=l);var h=n-(l-u);return i=this,o=arguments,h<=0||h>n?(a&&(clearTimeout(a),a=null),u=l,s=t.apply(i,o),a||(i=o=null)):a||!1===r.trailing||(a=setTimeout(c,h)),s}}(function(){this.history.push(new Float32Array(this.mouse))},1e3/60),update:function(t,e,n,r,i){try{var o=t.uniforms[r]=t.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+e,o.location=t.gl.getUniformLocation(t.program,r),t.gl[o.method].apply(t.gl,[o.location].concat(o.value))}catch(t){console.log("fastUpdate",t)}}};var e=Date.now||function(){return(new Date).getTime()};return t}();window.TrailsService=t}(),function(){"use strict";var t=acquireVsCodeApi();t.getState();function e(e){var n=window.options,r=[],i=[],o=[];e.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(t,e,i,s){var a='<li><span class="error" unselectable reveal-line="'+o.length+'"><span class="line">ERROR line '+Number(e)+'</span> <span class="value" title="'+i+'">'+i+'</span> <span class="text" title="'+s+'">'+s+"</span></span></li>";return r.push(a),o.push([n.uri,Number(e),"ERROR ("+i+") "+s]),a}),e.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(t,e,r,s){var a='<li><span class="warning" unselectable reveal-line="'+o.length+'"><span class="line">WARN line '+Number(e)+'</span> <span class="text" title="'+s+'">'+s+"</span></span></li>";return i.push(a),o.push([n.uri,Number(e),"ERROR ("+r+") "+s]),a});var s='<div class="errors-content"><div class="title">glsl-canvas error</div><ul>';s+=r.join("\n"),s+=i.join("\n"),s+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=s,[].slice.call(document.querySelectorAll(".errors [reveal-line]")).forEach(function(e){var n=parseInt(e.getAttribute("reveal-line"));e.addEventListener("click",function(){var e;e=o[n],t.postMessage({command:"revealGlslLine",data:JSON.stringify(e)})})}),document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var n,r,i=document.querySelector(".content"),o=document.querySelector(".shader"),s={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},a={toggle:!1,record:!1,stats:!1};m(),console.log("app.js workpath",options.workpath);var u=new GlslCanvas(o,{backgroundColor:"rgba(0.0, 0.0, 0.0, 0.0)",alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,workpath:options.workpath});if(u.gl){u.on("error",e);var c=new CaptureService;c.set(o);var l=new CameraService,h=new TrailsService;u.on("render",function(){a.stats&&n.end(),c.snapshotRender(),l.render(u),h.render(u),a.stats&&n.begin()});var d,f=new GuiService(p);y(),o.addEventListener("dblclick",v),o.addEventListener("mousedown",function(t){var e=Math.min(i.offsetWidth,i.offsetHeight);l.down(t.x/e,t.y/e)}),o.addEventListener("mousemove",function(t){var e=Math.min(i.offsetWidth,i.offsetHeight);l.move(t.x/e,t.y/e),h.move(t.x,i.offsetHeight-t.y)}),window.addEventListener("mouseup",function(t){var e=Math.min(i.offsetWidth,i.offsetHeight);l.up(t.x/e,t.y/e)}),window.addEventListener("mousewheel",function(t){l.wheel(t.wheelDelta/Math.abs(t.wheelDelta))}),s.pause.addEventListener("mousedown",v),s.record.addEventListener("mousedown",function(){a.record=!a.record,a.record?(s.record.setAttribute("class","btn btn-record active"),s.record.querySelector("i").setAttribute("class","icon-stop"),u.forceRender=!0,u.render(),c.record()):(s.record.setAttribute("class","btn btn-record"),s.record.querySelector("i").setAttribute("class","icon-record"),c.stop().then(function(t){var e=URL.createObjectURL(t.blob),n=document.createElement("a");n.href=e,n.download="shader"+t.extension,n.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)}))}),s.stats.addEventListener("mousedown",function(){a.stats=!a.stats,a.stats?(r?r.style.visibility="visible":((n=new Stats).showPanel(0),(r=n.dom).setAttribute("class","stats"),document.body.appendChild(n.dom)),f.show(),s.stats.setAttribute("class","btn btn-stats active")):g()}),s.create.addEventListener("click",function(e){t.postMessage({command:"createShader",data:null})}),window.addEventListener("message",function(e){window.options=JSON.parse(e.data),t.setState(window.options),y()},!1),window.addEventListener("resize",function(){d&&clearTimeout(d),d=setTimeout(m,50)}),m()}else document.querySelector(".missing").setAttribute("class","missing active");function p(t){var e=f.uniforms();u.setUniforms(e)}function y(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var t=window.options;for(var e in t.vertex=t.vertex.trim().length>0?t.vertex:null,t.fragment=t.fragment.trim().length>0?t.fragment:null,t.fragment||t.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),g()),console.log("load",t.textures),t.textures)u.setTexture("u_texture_"+e,t.textures[e],{filtering:"mipmap",repeat:!0});u.load(t.fragment,t.vertex),f.load(t.uniforms),u.setUniforms(f.uniforms())}function m(t){var e=i.offsetWidth,n=i.offsetHeight;o.style.width=e+"px",o.style.height=n+"px"}function v(){u.timer.paused?(a.pause=!1,u.play(),s.pause.querySelector("i").setAttribute("class","icon-pause")):(a.pause=!0,u.pause(),s.pause.querySelector("i").setAttribute("class","icon-play"))}function g(){r&&(r.style.visibility="hidden"),f.hide(),s.stats.setAttribute("class","btn btn-stats"),a.stats=!1}})}();
//# sourceMappingURL=app.min.js.map