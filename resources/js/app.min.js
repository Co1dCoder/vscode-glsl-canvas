!function(){"use strict";function e(){}function t(e){this.canvas=e}function r(){var e=this;if("function"!=typeof window.MediaRecorder||!e.canvas||"function"!=typeof e.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(e.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var t={},r=[],n=e.canvas.captureStream(),o={mimeType:"video/webm"},a=new MediaRecorder(n,o);a.ondataavailable=function(a){if(a.data.size>0&&r.push(a.data),t.resolve){var i=new Blob(r,{type:o.mimeType});if(n){(n.getTracks()||[]).forEach(function(e){e.stop(),n.removeTrack(e)})}n=null,e.recorder=null,e.capture=null,t.resolve({blob:i,extension:".webm"})}},e.capture=t,e.recorder=a,a.start()}catch(t){return e.capture=null,e.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0}function n(){var e=this;return e.capture?(e.capture.promise=new Promise(function(t,r){e.capture.resolve=t,e.capture.reject=r}),e.recorder.stop(),e.capture.promise):(console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}function o(){var e=this;return e.queue?e.queue.promise:(e.queue={},e.queue.promise=new Promise(function(t,r){e.queue.resolve=t,e.queue.reject=r}),e.queue.promise)}function a(){var e=this;if(e.queue){for(var t=e.canvas.toDataURL("image/png"),r=atob(t.slice(22)),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);var a=new Blob([n],{type:"image/png"});e.queue.resolve({blob:a,extension:".png"}),e.queue=null}}e.prototype={set:t,snapshot:o,snapshotRender:a,record:r,stop:n},window.CaptureService=e}(),function(){"use strict";var e=function(){function e(e){var t={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]},r=t[e.length],n={};return e.filter(function(e,t){n[r[t]]=e}),n}function t(e,t){var r={};return e.filter(function(e,n){r[t+n]=e}),r}function r(e){return function(t){return e[t]}}function n(r){var n={};for(var o in r){var a=r[o];if(Array.isArray(a))if(a.length>1)switch(typeof a[0]){case"number":a.length<5&&(n[o]=e(a));break;case"boolean":n[o]=t(a,"bool_");break;case"string":n[o]=t(a,"texture_");break;case"object":n[o]=t(a,"struct_")}else a.length&&(n[o]=a[0]);else void 0!==a&&null!==a&&(n[o]=a)}return n}function o(e){var t={};for(var n in e){var o=e[n];switch(typeof o){case"function":break;case"number":case"boolean":case"string":t[n]=o;break;default:var a=Object.keys(o);t[n]=a.map(r(o))}}return t}return{set:n,get:o}}(),t=function(){function t(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function r(e,t){return JSON.stringify(e)!==JSON.stringify(t)}function n(e){return JSON.parse(JSON.stringify(e))}function o(e,t){function r(e,t){for(var n in e)t.hasOwnProperty(n)&&("number"==typeof e[n]?e[n]=t[n]:"object"==typeof e[n]&&Object.keys(e[n]).length>0&&r(e[n],t[n]))}return e&&(e=n(e),r(e,t)),e}function a(e,t,r){var n,o=[];for(n in t)o.push(n);o.filter(function(o){var i=t[o];if("number"==typeof i)n=e.add(t,o,0,1),n.onChange(r);else if("object"==typeof i&&Object.keys(i).length>0){n=null;var s=e.addFolder(o);a(s,i,r)}else n=e.add(t,o),n.onChange(r)})}function i(e,t,r){function n(e,t){e.__controllers.filter(function(e){if("number"==typeof e.initialValue&&"number"==typeof e.__min&&"number"==typeof e.__max){var r=e.__min+(e.__max-e.__min)*Math.random();t[e.property]=r,e.updateDisplay()}});for(var r in e.__folders)n(e.__folders[r],t[r])}n(e,t),r()}function s(t){var s=this,u=s.gui,c=s.locals,l=r(t,c);if(u&&l&&(s.closed=u.closed,u.destroy(),u=null),u||(u=new dat.GUI,u.closed=s.closed,s.gui=u,s.hidden?s.hide():s.show()),l){c=n(t),s.locals=c;var d=e.set(t);d=o(d,s.pool),s.pool=d;var f=function(){s.callback(d)};a(u,d,f),d.randomize=function(){i(u,d,f)},u.add(d,"randomize")}}function u(){var e=this;e.gui.domElement.style.display="none",e.hidden=!0}function c(){var e=this,t=e.locals;if(Object.keys(t).length){e.gui.domElement.style.display=""}e.hidden=!1}function l(){var t=this,r=t.pool;return e.get(r)}return t.prototype={load:s,hide:u,show:c,uniforms:l},t}();window.GuiService=t}(),function(){"use strict";var e=function(){function e(){var e=this;e.mouse=new Float32Array([0,0]),e.history=[],e.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}function t(e){for(var t=this,r=t.trails,n=t.history,o=t.mouse,a=0,i=r.length,s=n.length?n[0]:o;a<i;){var u=a>0?r[a-1]:s,c=r[a],l=1/(5+a);c[0]+=(u[0]-c[0])*l,c[1]+=(u[1]-c[1])*l,t.update(e,"2fv","vec2","u_trails["+a+"]",c),a++}n.length&&n.shift()}function r(e,t){var r=this,n=r.mouse;n[0]=e,n[1]=t,r.push()}function n(){var e=this;e.history.push(new Float32Array(e.mouse))}function o(e,t,r,n,o){try{var a=e.uniforms[n]=e.uniforms[n]||{};a.name=n,a.value=o,a.type=r,a.method="uniform"+t,a.location=e.gl.getUniformLocation(e.program,n),e.gl[a.method].apply(e.gl,[a.location].concat(a.value))}catch(e){console.log("fastUpdate",e)}}e.prototype={render:t,move:r,push:function(e,t,r){var n,o,i,s=null,u=0;r||(r={});var c=function(){u=!1===r.leading?0:a(),s=null,i=e.apply(n,o),s||(n=o=null)};return function(){var l=a();u||!1!==r.leading||(u=l);var d=t-(l-u);return n=this,o=arguments,d<=0||d>t?(s&&(clearTimeout(s),s=null),u=l,i=e.apply(n,o),s||(n=o=null)):s||!1===r.trailing||(s=setTimeout(c,d)),i}}(n,1e3/60),update:o};var a=Date.now||function(){return(new Date).getTime()};return e}();window.TrailsService=e}(),function(){"use strict";function e(){function e(e){var t=A.uniforms();w.setUniforms(t)}function r(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var e=window.options;e.vertex=e.vertex.trim().length>0?e.vertex:null,e.fragment=e.fragment.trim().length>0?e.fragment:null,w.load(e.fragment,e.vertex);for(var t in e.textures)w.uniformTexture("u_texture_"+t,e.textures[t],{filtering:"mipmap",repeat:!0});A.load(e.uniforms),w.setUniforms(A.uniforms()),e.fragment||e.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),c())}function n(e){var t=h.offsetWidth,r=h.offsetHeight;y.style.width=t+"px",y.style.height=r+"px",e?(y.width=t,y.height=r):w.resize()}function o(){w.forceRender=!0,w.render(),S.record()}function a(){S.stop().then(function(e){var t=URL.createObjectURL(e.blob),r=document.createElement("a");r.href=t,r.download="shader"+e.extension,r.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)})}function i(){g.pause=!g.pause,w.paused?(w.timePause&&(w.timePrev=new Date,w.timeLoad+=w.timePrev-w.timePause),w.play(),b.pause.querySelector("i").setAttribute("class","icon-pause")):(w.pause(),w.timePause=new Date,b.pause.querySelector("i").setAttribute("class","icon-play"))}function s(){g.record=!g.record,g.record?(b.record.setAttribute("class","btn btn-record active"),b.record.querySelector("i").setAttribute("class","icon-stop"),o()):(b.record.setAttribute("class","btn btn-record"),b.record.querySelector("i").setAttribute("class","icon-record"),a())}function u(){function e(){m.update(),g.stats&&requestAnimationFrame(e)}g.stats=!g.stats,g.stats?(v?v.style.visibility="visible":(m=new Stats,m.showPanel(0),v=m.dom,document.body.appendChild(m.dom)),requestAnimationFrame(e),A.show(),b.stats.setAttribute("class","btn btn-stats active")):c()}function c(){v&&(v.style.visibility="hidden"),A.hide(),b.stats.setAttribute("class","btn btn-stats"),g.stats=!1}function l(e){window.parent.postMessage({command:"did-click-link",data:"command:glsl-canvas.createShader?"+JSON.stringify([options.uri])},"file://")}function d(e){window.options=JSON.parse(e.data),r()}function f(){R&&clearTimeout(R),R=setTimeout(n,50)}function p(e){q.move(e.x,h.offsetHeight-e.y)}var m,v,h=document.querySelector(".content"),y=document.querySelector(".shader"),b={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},g={toggle:!1,record:!1,stats:!1};n(!0);var w=new GlslCanvas(y,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});w.on("error",t);var S=new CaptureService;S.set(y);var q=new TrailsService;w.on("render",function(){S.snapshotRender(),q.render(w),w.forceRender=!0});var A=new GuiService(e);r();var R;y.addEventListener("dblclick",i),y.addEventListener("mousemove",p),b.pause.addEventListener("mousedown",i),b.record.addEventListener("mousedown",s),b.stats.addEventListener("mousedown",u),b.create.addEventListener("click",l),window.addEventListener("message",d,!1),window.addEventListener("resize",f),n()}function t(e){var t=window.options,r=[],n=[];e.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,n,o,a){var i="ERROR ("+o+") "+a,s='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(n),i]))+'"><span class="line">ERROR line '+Number(n)+'</span> <span class="value" title="'+o+'">'+o+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return r.push(s),s}),e.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(r,o,a,i){var s='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(o),e]))+'"><span class="line">WARN line '+Number(o)+'</span> <span class="text" title="'+i+'">'+i+"</span></a></li>";return n.push(s),s});var o='<div class="errors-content"><p>glslCanvas error</p><ul>';o+=r.join("\n"),o+=n.join("\n"),o+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=o}window.addEventListener("load",e)}();
//# sourceMappingURL=app.min.js.map
