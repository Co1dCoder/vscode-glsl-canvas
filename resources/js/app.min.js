!function(){"use strict";var e=function(){function r(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}return r.prototype={negative:function(){return new r(-this.x,-this.y,-this.z)},add:function(e){return e instanceof r?new r(this.x+e.x,this.y+e.y,this.z+e.z):new r(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof r?new r(this.x-e.x,this.y-e.y,this.z-e.z):new r(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof r?new r(this.x*e.x,this.y*e.y,this.z*e.z):new r(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof r?new r(this.x/e.x,this.y/e.y,this.z/e.z):new r(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new r(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new r(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},r.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},r.add=function(e,t,n){return t instanceof r?(n.x=e.x+t.x,n.y=e.y+t.y,n.z=e.z+t.z):(n.x=e.x+t,n.y=e.y+t,n.z=e.z+t),n},r.subtract=function(e,t,n){return t instanceof r?(n.x=e.x-t.x,n.y=e.y-t.y,n.z=e.z-t.z):(n.x=e.x-t,n.y=e.y-t,n.z=e.z-t),n},r.multiply=function(e,t,n){return t instanceof r?(n.x=e.x*t.x,n.y=e.y*t.y,n.z=e.z*t.z):(n.x=e.x*t,n.y=e.y*t,n.z=e.z*t),n},r.divide=function(e,t,n){return t instanceof r?(n.x=e.x/t.x,n.y=e.y/t.y,n.z=e.z/t.z):(n.x=e.x/t,n.y=e.y/t,n.z=e.z/t),n},r.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},r.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},r.fromAngles=function(e,t){return new r(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},r.randomDirection=function(){return r.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},r.min=function(e,t){return new r(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},r.max=function(e,t){return new r(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},r.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},r.fromArray=function(e){return new r(e[0],e[1],e[2])},r.angleBetween=function(e,t){return e.angleTo(t)},r}();window.Vector=e}(),function(){"use strict";var e=function(){var o=Math.PI/180;function i(e,t,n){this.theta=(e||45)*o,this.phi=(t||45)*o,this.radius=n||1}return i.prototype={down:function(e,t){this.mouse={x:e,y:t}},move:function(e,t){var n=this.mouse;if(n){var r=180*(e-n.x)*o,i=180*(n.y-t)*o;n.x=e,n.y=t,this.theta+=r,this.phi+=i}},up:function(e,t){this.mouse=null},wheel:function(e){this.radius=Math.max(.01,this.radius+.02*e)},render:function(e){var t=i.toVector(this),n=new Float32Array([t.x,t.y,t.z]);this.update(e,"3fv","vec3","u_camera",n)},update:function(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("fastUpdate",e)}}},i.fromVector=function(e){var t=e.length(),n=Math.acos(e.y/t),r=Math.atan(e.x/e.z);return new i(n,r,t)},i.toVector=function(e){var t=Math.sin(e.phi)*e.radius,n=t*Math.sin(e.theta),r=Math.cos(e.phi)*e.radius,i=t*Math.cos(e.theta);return new Vector(n,r,i)},i}();window.CameraService=e}(),function(){"use strict";function e(){}e.prototype={set:function(e){this.canvas=e},snapshot:function(){var n=this;if(n.queue)return n.queue.promise;return n.queue={},n.queue.promise=new Promise(function(e,t){n.queue.resolve=e,n.queue.reject=t}),n.queue.promise},snapshotRender:function(){if(this.queue){for(var e=this.canvas.toDataURL("image/png"),t=atob(e.slice(22)),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t.charCodeAt(r);var i=new Blob([n],{type:"image/png"});this.queue.resolve({blob:i,extension:".png"}),this.queue=null}},record:function(){var r=this;{if("function"!=typeof window.MediaRecorder||!r.canvas||"function"!=typeof r.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(r.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1}try{var i={},o=[],s=r.canvas.captureStream(),a={mimeType:"video/webm"},e=new MediaRecorder(s,a);e.ondataavailable=function(e){if(0<e.data.size&&o.push(e.data),i.resolve){var t=new Blob(o,{type:a.mimeType});if(s){var n=s.getTracks()||[];n.forEach(function(e){e.stop(),s.removeTrack(e)})}s=null,r.recorder=null,r.capture=null,i.resolve({blob:t,extension:".webm"})}},r.capture=i,(r.recorder=e).start()}catch(e){return r.capture=null,r.recorder=null,console.log("error: Scene video capture failed",e),!1}return!0},stop:function(){var n=this;if(!n.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return n.capture.promise=new Promise(function(e,t){n.capture.resolve=e,n.capture.reject=t}),n.recorder.stop(),n.capture.promise}},window.CaptureService=e}(),function(){"use strict";var l=function(){function i(e){var n={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]}[e.length],r={};return e.filter(function(e,t){r[n[t]]=e}),r}function o(e,n){var r={};return e.filter(function(e,t){r[n+t]=e}),r}function s(t){return function(e){return t[e]}}return{set:function(e){var t={};for(var n in e){var r=e[n];if(Array.isArray(r))if(1<r.length)switch(typeof r[0]){case"number":r.length<5&&(t[n]=i(r));break;case"boolean":t[n]=o(r,"bool_");break;case"string":t[n]=o(r,"texture_");break;case"object":t[n]=o(r,"struct_")}else r.length&&(t[n]=r[0]);else null!=r&&(t[n]=r)}return t},get:function(e){var t={};for(var n in e){var r=e[n];switch(typeof r){case"function":break;case"number":case"boolean":case"string":t[n]=r;break;default:var i=Object.keys(r);t[n]=i.map(s(r))}}return t}}}(),e=function(){function e(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function c(e){return JSON.parse(JSON.stringify(e))}return e.prototype={load:function(e){var t=this,n=t.gui,r=t.locals,i=(o=e,s=r,JSON.stringify(o)!==JSON.stringify(s));var o,s;n&&i&&(t.closed=n.closed,n.destroy(),n=null);n||((n=new dat.GUI).closed=t.closed,t.gui=n,t.hidden?t.hide():t.show());if(i){r=c(e),t.locals=r;var a=l.set(e);a=function(e,t){e&&function e(t,n){for(var r in t)n.hasOwnProperty(r)&&("number"==typeof t[r]?t[r]=n[r]:"object"==typeof t[r]&&0<Object.keys(t[r]).length&&e(t[r],n[r]))}(e=c(e),t);return e}(a,t.pool),t.pool=a;var u=function(){t.callback(a)};!function r(i,o,s){var a,e=[];for(a in o)e.push(a);e.filter(function(e){var t=o[e];if("number"==typeof t)(a=i.add(o,e,0,1)).onChange(s);else if("object"==typeof t&&0<Object.keys(t).length){a=null;var n=i.addFolder(e);r(n,t,s)}else(a=i.add(o,e)).onChange(s)})}(n,a,u),a.randomize=function(){var e;e=u,function e(t,n){for(var r in t.__controllers.filter(function(e){if("number"==typeof e.initialValue&&"number"==typeof e.__min&&"number"==typeof e.__max){var t=e.__min+(e.__max-e.__min)*Math.random();n[e.property]=t,e.updateDisplay()}}),t.__folders)e(t.__folders[r],n[r])}(n,a),e()},n.add(a,"randomize")}},hide:function(){this.hidden=!0;var e=this.gui;e&&(e.domElement.style.display="none")},show:function(){var e=this.locals,t=this.gui;t&&Object.keys(e).length&&(t.domElement.style.display="");this.hidden=!1},uniforms:function(){var e=this.pool;return l.get(e)}},e}();window.GuiService=e}(),function(){"use strict";var e=function(){function e(){this.mouse=new Float32Array([0,0]),this.history=[],this.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}e.prototype={render:function(e){var t=this.trails,n=this.history,r=this.mouse,i=0,o=t.length,s=n.length?n[0]:r;for(;i<o;){var a=0<i?t[i-1]:s,u=t[i],c=1/(5+i);u[0]+=(a[0]-u[0])*c,u[1]+=(a[1]-u[1])*c,this.update(e,"2fv","vec2","u_trails["+i+"]",u),i++}n.length&&n.shift()},move:function(e,t){var n=this.mouse;n[0]=e,n[1]=t,this.push()},push:function(n,r,i){var o,s,a,u=null,c=0;i||(i={});var l=function(){c=!1===i.leading?0:h(),u=null,a=n.apply(o,s),u||(o=s=null)};return function(){var e=h();c||!1!==i.leading||(c=e);var t=r-(e-c);return o=this,s=arguments,t<=0||r<t?(u&&(clearTimeout(u),u=null),c=e,a=n.apply(o,s),u||(o=s=null)):u||!1===i.trailing||(u=setTimeout(l,t)),a}}(function(){this.history.push(new Float32Array(this.mouse))},1e3/60),update:function(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("fastUpdate",e)}}};var h=Date.now||function(){return(new Date).getTime()};return e}();window.TrailsService=e}(),function(){"use strict";function v(o){var s=window.options,a=[],u=[];o.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,t,n,r){var i="ERROR ("+n+") "+r,o='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([s.uri,Number(t),i]))+'"><span class="line">ERROR line '+Number(t)+'</span> <span class="value" title="'+n+'">'+n+'</span> <span class="text" title="'+r+'">'+r+"</span></a></li>";return a.push(o),o}),o.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(e,t,n,r){var i='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([s.uri,Number(t),o]))+'"><span class="line">WARN line '+Number(t)+'</span> <span class="text" title="'+r+'">'+r+"</span></a></li>";return u.push(i),i});var e='<div class="errors-content"><p>glslCanvas error</p><ul>';e+=a.join("\n"),e+=u.join("\n"),e+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=e,document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var t,e,r=document.querySelector(".content"),i=document.querySelector(".shader"),n={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},o={toggle:!1,record:!1,stats:!1};m(!0);var s=new GlslCanvas(i,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});if(s.gl){s.on("error",v);var a=new CaptureService;a.set(i);var u=new CameraService,c=new TrailsService;s.on("render",function(){a.snapshotRender(),u.render(s),c.render(s)});var l,h=new GuiService(f);d(),i.addEventListener("dblclick",y),i.addEventListener("mousedown",function(e){var t=Math.min(r.offsetWidth,r.offsetHeight);u.down(e.x/t,e.y/t)}),i.addEventListener("mousemove",function(e){var t=Math.min(r.offsetWidth,r.offsetHeight);u.move(e.x/t,e.y/t),c.move(e.x,r.offsetHeight-e.y)}),window.addEventListener("mouseup",function(e){var t=Math.min(r.offsetWidth,r.offsetHeight);u.up(e.x/t,e.y/t)}),window.addEventListener("mousewheel",function(e){u.wheel(e.wheelDelta/Math.abs(e.wheelDelta))}),n.pause.addEventListener("mousedown",y),n.record.addEventListener("mousedown",function(){o.record=!o.record,o.record?(n.record.setAttribute("class","btn btn-record active"),n.record.querySelector("i").setAttribute("class","icon-stop"),s.forceRender=!0,s.render(),a.record()):(n.record.setAttribute("class","btn btn-record"),n.record.querySelector("i").setAttribute("class","icon-record"),a.stop().then(function(e){var t=URL.createObjectURL(e.blob),n=document.createElement("a");n.href=t,n.download="shader"+e.extension,n.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)}))}),n.stats.addEventListener("mousedown",function(){o.stats=!o.stats,o.stats?(e?e.style.visibility="visible":((t=new Stats).showPanel(0),(e=t.dom).setAttribute("class","stats"),document.body.appendChild(t.dom)),requestAnimationFrame(function e(){t.update(),o.stats&&requestAnimationFrame(e)}),h.show(),n.stats.setAttribute("class","btn btn-stats active")):p()}),n.create.addEventListener("click",function(e){window.parent.postMessage({command:"did-click-link",data:"command:glsl-canvas.createShader?"+JSON.stringify([options.uri])},"file://")}),window.addEventListener("message",function(e){window.options=JSON.parse(e.data),d()},!1),window.addEventListener("resize",function(){l&&clearTimeout(l),l=setTimeout(m,50)}),m()}else document.querySelector(".missing").setAttribute("class","missing active");function f(e){var t=h.uniforms();s.setUniforms(t)}function d(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var e=window.options;for(var t in e.vertex=0<e.vertex.trim().length?e.vertex:null,e.fragment=0<e.fragment.trim().length?e.fragment:null,e.fragment||e.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),p()),s.load(e.fragment,e.vertex),e.textures)s.uniformTexture("u_texture_"+t,e.textures[t],{filtering:"mipmap",repeat:!0});h.load(e.uniforms),s.setUniforms(h.uniforms())}function m(e){var t=r.offsetWidth,n=r.offsetHeight;i.style.width=t+"px",i.style.height=n+"px",e?(i.width=t,i.height=n):s.resize()}function y(){o.pause=!o.pause,s.paused?(s.timePause&&(s.timePrev=new Date,s.timeLoad+=s.timePrev-s.timePause),s.play(),n.pause.querySelector("i").setAttribute("class","icon-pause")):(s.pause(),s.timePause=new Date,n.pause.querySelector("i").setAttribute("class","icon-play"))}function p(){e&&(e.style.visibility="hidden"),h.hide(),n.stats.setAttribute("class","btn btn-stats"),o.stats=!1}})}();
//# sourceMappingURL=app.min.js.map
