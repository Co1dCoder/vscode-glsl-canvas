!function(){"use strict";var e=function(){function e(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}return e.prototype={negative:function(){return new e(-this.x,-this.y,-this.z)},add:function(t){return t instanceof e?new e(this.x+t.x,this.y+t.y,this.z+t.z):new e(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof e?new e(this.x-t.x,this.y-t.y,this.z-t.z):new e(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof e?new e(this.x*t.x,this.y*t.y,this.z*t.z):new e(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof e?new e(this.x/t.x,this.y/t.y,this.z/t.z):new e(this.x/t,this.y/t,this.z/t)},equals:function(e){return this.x===e.x&&this.y===e.y&&this.z===e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(t){return new e(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new e(this.x,this.y,this.z)},init:function(e,t,n){return this.x=e,this.y=t,this.z=n,this}},e.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.add=function(t,n,r){return n instanceof e?(r.x=t.x+n.x,r.y=t.y+n.y,r.z=t.z+n.z):(r.x=t.x+n,r.y=t.y+n,r.z=t.z+n),r},e.subtract=function(t,n,r){return n instanceof e?(r.x=t.x-n.x,r.y=t.y-n.y,r.z=t.z-n.z):(r.x=t.x-n,r.y=t.y-n,r.z=t.z-n),r},e.multiply=function(t,n,r){return n instanceof e?(r.x=t.x*n.x,r.y=t.y*n.y,r.z=t.z*n.z):(r.x=t.x*n,r.y=t.y*n,r.z=t.z*n),r},e.divide=function(t,n,r){return n instanceof e?(r.x=t.x/n.x,r.y=t.y/n.y,r.z=t.z/n.z):(r.x=t.x/n,r.y=t.y/n,r.z=t.z/n),r},e.cross=function(e,t,n){return n.x=e.y*t.z-e.z*t.y,n.y=e.z*t.x-e.x*t.z,n.z=e.x*t.y-e.y*t.x,n},e.unit=function(e,t){var n=e.length();return t.x=e.x/n,t.y=e.y/n,t.z=e.z/n,t},e.fromAngles=function(t,n){return new e(Math.cos(t)*Math.cos(n),Math.sin(n),Math.sin(t)*Math.cos(n))},e.randomDirection=function(){return e.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},e.min=function(t,n){return new e(Math.min(t.x,n.x),Math.min(t.y,n.y),Math.min(t.z,n.z))},e.max=function(t,n){return new e(Math.max(t.x,n.x),Math.max(t.y,n.y),Math.max(t.z,n.z))},e.lerp=function(e,t,n){return t.subtract(e).multiply(n).add(e)},e.fromArray=function(t){return new e(t[0],t[1],t[2])},e.angleBetween=function(e,t){return e.angleTo(t)},e}();window.Vector=e}(),function(){"use strict";var e=function(){function e(e,t,n){var r=this;r.theta=(e||45)*l,r.phi=(t||45)*l,r.radius=n||1}function t(e,t){this.mouse={x:e,y:t}}function n(e,t){var n=this,r=n.mouse;if(r){var i=180*(e-r.x)*l,o=180*(r.y-t)*l;r.x=e,r.y=t,n.theta+=i,n.phi+=o}}function r(e,t){this.mouse=null}function i(e){var t=this;t.radius=Math.max(.01,t.radius+.02*e)}function o(t){var n=this,r=e.toVector(n),i=new Float32Array([r.x,r.y,r.z]);n.update(t,"3fv","vec3","u_camera",i)}function a(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("fastUpdate",e)}}function s(t){var n=t.length();return new e(Math.acos(t.y/n),Math.atan(t.x/t.z),n)}function u(e){var t=Math.sin(e.phi)*e.radius,n=t*Math.sin(e.theta),r=Math.cos(e.phi)*e.radius,i=t*Math.cos(e.theta);return new Vector(n,r,i)}var c=Math.PI,l=c/180;return e.prototype={down:t,move:n,up:r,wheel:i,render:o,update:a},e.fromVector=s,e.toVector=u,e}();window.CameraService=e}(),function(){"use strict";function e(){}function t(e){this.canvas=e}function n(){var e=this;if("function"!=typeof window.MediaRecorder||!e.canvas||"function"!=typeof e.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(e.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1;try{var t={},n=[],r=e.canvas.captureStream(),i={mimeType:"video/webm"},o=new MediaRecorder(r,i);o.ondataavailable=function(o){if(o.data.size>0&&n.push(o.data),t.resolve){var a=new Blob(n,{type:i.mimeType});if(r){(r.getTracks()||[]).forEach(function(e){e.stop(),r.removeTrack(e)})}r=null,e.recorder=null,e.capture=null,t.resolve({blob:a,extension:".webm"})}},e.capture=t,e.recorder=o,o.start()}catch(t){return e.capture=null,e.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0}function r(){var e=this;return e.capture?(e.capture.promise=new Promise(function(t,n){e.capture.resolve=t,e.capture.reject=n}),e.recorder.stop(),e.capture.promise):(console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({}))}function i(){var e=this;return e.queue?e.queue.promise:(e.queue={},e.queue.promise=new Promise(function(t,n){e.queue.resolve=t,e.queue.reject=n}),e.queue.promise)}function o(){var e=this;if(e.queue){for(var t=e.canvas.toDataURL("image/png"),n=atob(t.slice(22)),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);var o=new Blob([r],{type:"image/png"});e.queue.resolve({blob:o,extension:".png"}),e.queue=null}}e.prototype={set:t,snapshot:i,snapshotRender:o,record:n,stop:r},window.CaptureService=e}(),function(){"use strict";var e=function(){function e(e){var t={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]},n=t[e.length],r={};return e.filter(function(e,t){r[n[t]]=e}),r}function t(e,t){var n={};return e.filter(function(e,r){n[t+r]=e}),n}function n(e){return function(t){return e[t]}}function r(n){var r={};for(var i in n){var o=n[i];if(Array.isArray(o))if(o.length>1)switch(typeof o[0]){case"number":o.length<5&&(r[i]=e(o));break;case"boolean":r[i]=t(o,"bool_");break;case"string":r[i]=t(o,"texture_");break;case"object":r[i]=t(o,"struct_")}else o.length&&(r[i]=o[0]);else void 0!==o&&null!==o&&(r[i]=o)}return r}function i(e){var t={};for(var r in e){var i=e[r];switch(typeof i){case"function":break;case"number":case"boolean":case"string":t[r]=i;break;default:var o=Object.keys(i);t[r]=o.map(n(i))}}return t}return{set:r,get:i}}(),t=function(){function t(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function n(e,t){return JSON.stringify(e)!==JSON.stringify(t)}function r(e){return JSON.parse(JSON.stringify(e))}function i(e,t){function n(e,t){for(var r in e)t.hasOwnProperty(r)&&("number"==typeof e[r]?e[r]=t[r]:"object"==typeof e[r]&&Object.keys(e[r]).length>0&&n(e[r],t[r]))}return e&&(e=r(e),n(e,t)),e}function o(e,t,n){var r,i=[];for(r in t)i.push(r);i.filter(function(i){var a=t[i];if("number"==typeof a)r=e.add(t,i,0,1),r.onChange(n);else if("object"==typeof a&&Object.keys(a).length>0){r=null;var s=e.addFolder(i);o(s,a,n)}else r=e.add(t,i),r.onChange(n)})}function a(e,t,n){function r(e,t){e.__controllers.filter(function(e){if("number"==typeof e.initialValue&&"number"==typeof e.__min&&"number"==typeof e.__max){var n=e.__min+(e.__max-e.__min)*Math.random();t[e.property]=n,e.updateDisplay()}});for(var n in e.__folders)r(e.__folders[n],t[n])}r(e,t),n()}function s(t){var s=this,u=s.gui,c=s.locals,l=n(t,c);if(u&&l&&(s.closed=u.closed,u.destroy(),u=null),u||(u=new dat.GUI,u.closed=s.closed,s.gui=u,s.hidden?s.hide():s.show()),l){c=r(t),s.locals=c;var f=e.set(t);f=i(f,s.pool),s.pool=f;var d=function(){s.callback(f)};o(u,f,d),f.randomize=function(){a(u,f,d)},u.add(f,"randomize")}}function u(){var e=this;e.hidden=!0;var t=e.gui;t&&(t.domElement.style.display="none")}function c(){var e=this,t=e.locals,n=e.gui;n&&Object.keys(t).length&&(n.domElement.style.display=""),e.hidden=!1}function l(){var t=this,n=t.pool;return e.get(n)}return t.prototype={load:s,hide:u,show:c,uniforms:l},t}();window.GuiService=t}(),function(){"use strict";var e=function(){function e(){var e=this;e.mouse=new Float32Array([0,0]),e.history=[],e.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}function t(e){for(var t=this,n=t.trails,r=t.history,i=t.mouse,o=0,a=n.length,s=r.length?r[0]:i;o<a;){var u=o>0?n[o-1]:s,c=n[o],l=1/(5+o);c[0]+=(u[0]-c[0])*l,c[1]+=(u[1]-c[1])*l,t.update(e,"2fv","vec2","u_trails["+o+"]",c),o++}r.length&&r.shift()}function n(e,t){var n=this,r=n.mouse;r[0]=e,r[1]=t,n.push()}function r(){var e=this;e.history.push(new Float32Array(e.mouse))}function i(e,t,n,r,i){try{var o=e.uniforms[r]=e.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+t,o.location=e.gl.getUniformLocation(e.program,r),e.gl[o.method].apply(e.gl,[o.location].concat(o.value))}catch(e){console.log("fastUpdate",e)}}e.prototype={render:t,move:n,push:function(e,t,n){var r,i,a,s=null,u=0;n||(n={});var c=function(){u=!1===n.leading?0:o(),s=null,a=e.apply(r,i),s||(r=i=null)};return function(){var l=o();u||!1!==n.leading||(u=l);var f=t-(l-u);return r=this,i=arguments,f<=0||f>t?(s&&(clearTimeout(s),s=null),u=l,a=e.apply(r,i),s||(r=i=null)):s||!1===n.trailing||(s=setTimeout(c,f)),a}}(r,1e3/60),update:i};var o=Date.now||function(){return(new Date).getTime()};return e}();window.TrailsService=e}(),function(){"use strict";function e(){function e(e){var t=R.uniforms();S.setUniforms(t)}function n(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var e=window.options;e.vertex=e.vertex.trim().length>0?e.vertex:null,e.fragment=e.fragment.trim().length>0?e.fragment:null,e.fragment||e.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),c()),S.load(e.fragment,e.vertex);for(var t in e.textures)S.uniformTexture("u_texture_"+t,e.textures[t],{filtering:"mipmap",repeat:!0});R.load(e.uniforms),S.setUniforms(R.uniforms())}function r(e){var t=g.offsetWidth,n=g.offsetHeight;x.style.width=t+"px",x.style.height=n+"px",e?(x.width=t,x.height=n):S.resize()}function i(){S.forceRender=!0,S.render(),M.record()}function o(){M.stop().then(function(e){var t=URL.createObjectURL(e.blob),n=document.createElement("a");n.href=t,n.download="shader"+e.extension,n.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)})}function a(){z.pause=!z.pause,S.paused?(S.timePause&&(S.timePrev=new Date,S.timeLoad+=S.timePrev-S.timePause),S.play(),b.pause.querySelector("i").setAttribute("class","icon-pause")):(S.pause(),S.timePause=new Date,b.pause.querySelector("i").setAttribute("class","icon-play"))}function s(){z.record=!z.record,z.record?(b.record.setAttribute("class","btn btn-record active"),b.record.querySelector("i").setAttribute("class","icon-stop"),i()):(b.record.setAttribute("class","btn btn-record"),b.record.querySelector("i").setAttribute("class","icon-record"),o())}function u(){function e(){v.update(),z.stats&&requestAnimationFrame(e)}z.stats=!z.stats,z.stats?(w?w.style.visibility="visible":(v=new Stats,v.showPanel(0),w=v.dom,w.setAttribute("class","stats"),document.body.appendChild(v.dom)),requestAnimationFrame(e),R.show(),b.stats.setAttribute("class","btn btn-stats active")):c()}function c(){w&&(w.style.visibility="hidden"),R.hide(),b.stats.setAttribute("class","btn btn-stats"),z.stats=!1}function l(e){window.parent.postMessage({command:"did-click-link",data:"command:glsl-canvas.createShader?"+JSON.stringify([options.uri])},"file://")}function f(e){window.options=JSON.parse(e.data),n()}function d(){L&&clearTimeout(L),L=setTimeout(r,50)}function h(e){var t=Math.min(g.offsetWidth,g.offsetHeight);A.down(e.x/t,e.y/t)}function m(e){var t=Math.min(g.offsetWidth,g.offsetHeight);A.move(e.x/t,e.y/t),q.move(e.x,g.offsetHeight-e.y)}function y(e){var t=Math.min(g.offsetWidth,g.offsetHeight);A.up(e.x/t,e.y/t)}function p(e){A.wheel(e.wheelDelta/Math.abs(e.wheelDelta))}var v,w,g=document.querySelector(".content"),x=document.querySelector(".shader"),b={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},z={toggle:!1,record:!1,stats:!1};r(!0);var S=new GlslCanvas(x,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});S.on("error",t);var M=new CaptureService;M.set(x);var A=new CameraService,q=new TrailsService;S.on("render",function(){M.snapshotRender(),A.render(S),q.render(S),S.forceRender=!0});var R=new GuiService(e);n();var L;x.addEventListener("dblclick",a),x.addEventListener("mousedown",h),x.addEventListener("mousemove",m),window.addEventListener("mouseup",y),window.addEventListener("mousewheel",p),b.pause.addEventListener("mousedown",a),b.record.addEventListener("mousedown",s),b.stats.addEventListener("mousedown",u),b.create.addEventListener("click",l),window.addEventListener("message",f,!1),window.addEventListener("resize",d),r()}function t(e){var t=window.options,n=[],r=[];e.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,r,i,o){var a="ERROR ("+i+") "+o,s='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(r),a]))+'"><span class="line">ERROR line '+Number(r)+'</span> <span class="value" title="'+i+'">'+i+'</span> <span class="text" title="'+o+'">'+o+"</span></a></li>";return n.push(s),s}),e.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(n,i,o,a){var s='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(i),e]))+'"><span class="line">WARN line '+Number(i)+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return r.push(s),s});var i='<div class="errors-content"><p>glslCanvas error</p><ul>';i+=n.join("\n"),i+=r.join("\n"),i+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=i,document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",e)}();
//# sourceMappingURL=app.min.js.map
