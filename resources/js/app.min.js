!function(){"use strict";var t=function(){function r(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}return r.prototype={negative:function(){return new r(-this.x,-this.y,-this.z)},add:function(t){return t instanceof r?new r(this.x+t.x,this.y+t.y,this.z+t.z):new r(this.x+t,this.y+t,this.z+t)},subtract:function(t){return t instanceof r?new r(this.x-t.x,this.y-t.y,this.z-t.z):new r(this.x-t,this.y-t,this.z-t)},multiply:function(t){return t instanceof r?new r(this.x*t.x,this.y*t.y,this.z*t.z):new r(this.x*t,this.y*t,this.z*t)},divide:function(t){return t instanceof r?new r(this.x/t.x,this.y/t.y,this.z/t.z):new r(this.x/t,this.y/t,this.z/t)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},cross:function(t){return new r(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},angleTo:function(t){return Math.acos(this.dot(t)/(this.length()*t.length()))},toArray:function(t){return[this.x,this.y,this.z].slice(0,t||3)},clone:function(){return new r(this.x,this.y,this.z)},init:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},r.negative=function(t,e){return e.x=-t.x,e.y=-t.y,e.z=-t.z,e},r.add=function(t,e,n){return e instanceof r?(n.x=t.x+e.x,n.y=t.y+e.y,n.z=t.z+e.z):(n.x=t.x+e,n.y=t.y+e,n.z=t.z+e),n},r.subtract=function(t,e,n){return e instanceof r?(n.x=t.x-e.x,n.y=t.y-e.y,n.z=t.z-e.z):(n.x=t.x-e,n.y=t.y-e,n.z=t.z-e),n},r.multiply=function(t,e,n){return e instanceof r?(n.x=t.x*e.x,n.y=t.y*e.y,n.z=t.z*e.z):(n.x=t.x*e,n.y=t.y*e,n.z=t.z*e),n},r.divide=function(t,e,n){return e instanceof r?(n.x=t.x/e.x,n.y=t.y/e.y,n.z=t.z/e.z):(n.x=t.x/e,n.y=t.y/e,n.z=t.z/e),n},r.cross=function(t,e,n){return n.x=t.y*e.z-t.z*e.y,n.y=t.z*e.x-t.x*e.z,n.z=t.x*e.y-t.y*e.x,n},r.unit=function(t,e){var n=t.length();return e.x=t.x/n,e.y=t.y/n,e.z=t.z/n,e},r.fromAngles=function(t,e){return new r(Math.cos(t)*Math.cos(e),Math.sin(e),Math.sin(t)*Math.cos(e))},r.randomDirection=function(){return r.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},r.min=function(t,e){return new r(Math.min(t.x,e.x),Math.min(t.y,e.y),Math.min(t.z,e.z))},r.max=function(t,e){return new r(Math.max(t.x,e.x),Math.max(t.y,e.y),Math.max(t.z,e.z))},r.lerp=function(t,e,n){return e.subtract(t).multiply(n).add(t)},r.fromArray=function(t){return new r(t[0],t[1],t[2])},r.angleBetween=function(t,e){return t.angleTo(e)},r}();window.Vector=t}(),function(){"use strict";var t=function(){var o=Math.PI/180;function i(t,e,n){this.theta=(t||45)*o,this.phi=(e||45)*o,this.radius=n||1}return i.prototype={down:function(t,e){this.mouse={x:t,y:e}},move:function(t,e){var n=this.mouse;if(n){var r=180*(t-n.x)*o,i=180*(n.y-e)*o;n.x=t,n.y=e,this.theta+=r,this.phi+=i}},up:function(t,e){this.mouse=null},wheel:function(t){this.radius=Math.max(.01,this.radius+.02*t)},render:function(t){var e=i.toVector(this),n=new Float32Array([e.x,e.y,e.z]);this.update(t,"3fv","vec3","u_camera",n)},update:function(t,e,n,r,i){try{var o=t.uniforms[r]=t.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+e,o.location=t.gl.getUniformLocation(t.program,r),t.gl[o.method].apply(t.gl,[o.location].concat(o.value))}catch(t){console.log("fastUpdate",t)}}},i.fromVector=function(t){var e=t.length(),n=Math.acos(t.y/e),r=Math.atan(t.x/t.z);return new i(n,r,e)},i.toVector=function(t){var e=Math.sin(t.phi)*t.radius,n=e*Math.sin(t.theta),r=Math.cos(t.phi)*t.radius,i=e*Math.cos(t.theta);return new Vector(n,r,i)},i}();window.CameraService=t}(),function(){"use strict";function t(){}t.prototype={set:function(t){this.canvas=t},snapshot:function(){var n=this;if(n.queue)return n.queue.promise;return n.queue={},n.queue.promise=new Promise(function(t,e){n.queue.resolve=t,n.queue.reject=e}),n.queue.promise},snapshotRender:function(){if(this.queue){for(var t=this.canvas.toDataURL("image/png"),e=atob(t.slice(22)),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);var i=new Blob([n],{type:"image/png"});this.queue.resolve({blob:i,extension:".png"}),this.queue=null}},record:function(){var r=this;{if("function"!=typeof window.MediaRecorder||!r.canvas||"function"!=typeof r.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(r.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1}try{var i={},o=[],s=r.canvas.captureStream(),a={mimeType:"video/webm"},t=new MediaRecorder(s,a);t.ondataavailable=function(t){if(0<t.data.size&&o.push(t.data),i.resolve){var e=new Blob(o,{type:a.mimeType});if(s){var n=s.getTracks()||[];n.forEach(function(t){t.stop(),s.removeTrack(t)})}s=null,r.recorder=null,r.capture=null,i.resolve({blob:e,extension:".webm"})}},r.capture=i,(r.recorder=t).start()}catch(t){return r.capture=null,r.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0},stop:function(){var n=this;if(!n.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return n.capture.promise=new Promise(function(t,e){n.capture.resolve=t,n.capture.reject=e}),n.recorder.stop(),n.capture.promise}},window.CaptureService=t}(),function(){"use strict";var l=function(){function i(t){var n={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]}[t.length],r={};return t.filter(function(t,e){r[n[e]]=t}),r}function o(t,n){var r={};return t.filter(function(t,e){r[n+e]=t}),r}function s(e){return function(t){return e[t]}}return{set:function(t){var e={};for(var n in t){var r=t[n];if(Array.isArray(r))if(1<r.length)switch(typeof r[0]){case"number":r.length<5&&(e[n]=i(r));break;case"boolean":e[n]=o(r,"bool_");break;case"string":e[n]=o(r,"texture_");break;case"object":e[n]=o(r,"struct_")}else r.length&&(e[n]=r[0]);else null!=r&&(e[n]=r)}return e},get:function(t){var e={};for(var n in t){var r=t[n];switch(typeof r){case"function":break;case"number":case"boolean":case"string":e[n]=r;break;default:var i=Object.keys(r);e[n]=i.map(s(r))}}return e}}}(),t=function(){function t(t){this.closed=!0,this.hidden=!0,this.callback=t||function(){console.log("GuiService.onChange")},this.pool={}}function c(t){return JSON.parse(JSON.stringify(t))}return t.prototype={load:function(t){var e=this,n=e.gui,r=e.locals,i=(o=t,s=r,JSON.stringify(o)!==JSON.stringify(s));var o,s;n&&i&&(e.closed=n.closed,n.destroy(),n=null);n||((n=new dat.GUI).closed=e.closed,e.gui=n,e.hidden?e.hide():e.show());if(i){r=c(t),e.locals=r;var a=l.set(t);a=function(t,e){t&&function t(e,n){for(var r in e)n.hasOwnProperty(r)&&("number"==typeof e[r]?e[r]=n[r]:"object"==typeof e[r]&&0<Object.keys(e[r]).length&&t(e[r],n[r]))}(t=c(t),e);return t}(a,e.pool),e.pool=a;var u=function(){e.callback(a)};!function r(i,o,s){var a,t=[];for(a in o)t.push(a);t.filter(function(t){var e=o[t];if("number"==typeof e)(a=i.add(o,t,0,1)).onChange(s);else if("object"==typeof e&&0<Object.keys(e).length){a=null;var n=i.addFolder(t);r(n,e,s)}else(a=i.add(o,t)).onChange(s)})}(n,a,u),a.randomize=function(){var t;t=u,function t(e,n){for(var r in e.__controllers.filter(function(t){if("number"==typeof t.initialValue&&"number"==typeof t.__min&&"number"==typeof t.__max){var e=t.__min+(t.__max-t.__min)*Math.random();n[t.property]=e,t.updateDisplay()}}),e.__folders)t(e.__folders[r],n[r])}(n,a),t()},n.add(a,"randomize")}else e.callback(e.pool)},hide:function(){this.hidden=!0;var t=this.gui;t&&(t.domElement.style.display="none")},show:function(){var t=this.locals,e=this.gui;e&&Object.keys(t).length&&(e.domElement.style.display="");this.hidden=!1},uniforms:function(){var t=this.pool;return l.get(t)}},t}();window.GuiService=t}(),function(){"use strict";var t=function(){function t(){this.mouse=new Float32Array([0,0]),this.history=[],this.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}t.prototype={render:function(t){var e=this.trails,n=this.history,r=this.mouse,i=0,o=e.length,s=n.length?n[0]:r;for(;i<o;){var a=0<i?e[i-1]:s,u=e[i],c=1/(5+i);u[0]+=(a[0]-u[0])*c,u[1]+=(a[1]-u[1])*c,this.update(t,"2fv","vec2","u_trails["+i+"]",u),i++}n.length&&n.shift()},move:function(t,e){var n=this.mouse;n[0]=t,n[1]=e,this.push()},push:function(n,r,i){var o,s,a,u=null,c=0;i||(i={});var l=function(){c=!1===i.leading?0:h(),u=null,a=n.apply(o,s),u||(o=s=null)};return function(){var t=h();c||!1!==i.leading||(c=t);var e=r-(t-c);return o=this,s=arguments,e<=0||r<e?(u&&(clearTimeout(u),u=null),c=t,a=n.apply(o,s),u||(o=s=null)):u||!1===i.trailing||(u=setTimeout(l,e)),a}}(function(){this.history.push(new Float32Array(this.mouse))},1e3/60),update:function(t,e,n,r,i){try{var o=t.uniforms[r]=t.uniforms[r]||{};o.name=r,o.value=i,o.type=n,o.method="uniform"+e,o.location=t.gl.getUniformLocation(t.program,r),t.gl[o.method].apply(t.gl,[o.location].concat(o.value))}catch(t){console.log("fastUpdate",t)}}};var h=Date.now||function(){return(new Date).getTime()};return t}();window.TrailsService=t}(),function(){"use strict";var v=acquireVsCodeApi();v.getState();function g(t){var o=window.options,s=[],a=[],u=[];t.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(t,e,n,r){var i='<li><span class="error" unselectable reveal-line="'+u.length+'"><span class="line">ERROR line '+Number(e)+'</span> <span class="value" title="'+n+'">'+n+'</span> <span class="text" title="'+r+'">'+r+"</span></span></li>";return s.push(i),u.push([o.uri,Number(e),"ERROR ("+n+") "+r]),i}),t.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(t,e,n,r){var i='<li><span class="warning" unselectable reveal-line="'+u.length+'"><span class="line">WARN line '+Number(e)+'</span> <span class="text" title="'+r+'">'+r+"</span></span></li>";return a.push(i),u.push([o.uri,Number(e),"ERROR ("+n+") "+r]),i});var e='<div class="errors-content"><div class="title">glsl-canvas error</div><ul>';e+=s.join("\n"),e+=a.join("\n"),e+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=e,[].slice.call(document.querySelectorAll(".errors [reveal-line]")).forEach(function(t){var e=parseInt(t.getAttribute("reveal-line"));t.addEventListener("click",function(){var t;t=u[e],v.postMessage({command:"revealGlslLine",data:JSON.stringify(t)})})}),document.querySelector("body").setAttribute("class","idle")}window.addEventListener("load",function(){var t,e,r=document.querySelector(".content"),i=document.querySelector(".shader"),n={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},o={toggle:!1,record:!1,stats:!1};p(),console.log("app.js workpath",options.workpath);var s=new GlslCanvas(i,{backgroundColor:"rgba(0.0, 0.0, 0.0, 0.0)",alpha:!0,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,workpath:options.workpath});if(s.gl){s.on("error",g);var a=new CaptureService;a.set(i);var u=new CameraService,c=new TrailsService;s.on("render",function(){o.stats&&t.end(),a.snapshotRender(),u.render(s),c.render(s),o.stats&&t.begin()});var l,h=new GuiService(d);f(),i.addEventListener("dblclick",y),i.addEventListener("mousedown",function(t){var e=Math.min(r.offsetWidth,r.offsetHeight);u.down(t.x/e,t.y/e)}),i.addEventListener("mousemove",function(t){var e=Math.min(r.offsetWidth,r.offsetHeight);u.move(t.x/e,t.y/e),c.move(t.x,r.offsetHeight-t.y)}),window.addEventListener("mouseup",function(t){var e=Math.min(r.offsetWidth,r.offsetHeight);u.up(t.x/e,t.y/e)}),window.addEventListener("mousewheel",function(t){u.wheel(t.wheelDelta/Math.abs(t.wheelDelta))}),n.pause.addEventListener("mousedown",y),n.record.addEventListener("mousedown",function(){o.record=!o.record,o.record?(n.record.setAttribute("class","btn btn-record active"),n.record.querySelector("i").setAttribute("class","icon-stop"),s.forceRender=!0,s.render(),a.record()):(n.record.setAttribute("class","btn btn-record"),n.record.querySelector("i").setAttribute("class","icon-record"),a.stop().then(function(t){var e=URL.createObjectURL(t.blob),n=document.createElement("a");n.href=e,n.download="shader"+t.extension,n.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)}))}),n.stats.addEventListener("mousedown",function(){o.stats=!o.stats,o.stats?(e?e.style.visibility="visible":((t=new Stats).showPanel(0),(e=t.dom).setAttribute("class","stats"),document.body.appendChild(t.dom)),h.show(),n.stats.setAttribute("class","btn btn-stats active")):m()}),n.create.addEventListener("click",function(t){v.postMessage({command:"createShader",data:null})}),window.addEventListener("message",function(t){window.options=JSON.parse(t.data),v.setState(window.options),f()},!1),window.addEventListener("resize",function(){l&&clearTimeout(l),l=setTimeout(p,50)}),p()}else document.querySelector(".missing").setAttribute("class","missing active");function d(t){var e=h.uniforms();s.setUniforms(e)}function f(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var t=window.options;for(var e in t.vertex=0<t.vertex.trim().length?t.vertex:null,t.fragment=0<t.fragment.trim().length?t.fragment:null,t.fragment||t.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),m()),t.textures)s.setTexture("u_texture_"+e,t.textures[e],{filtering:"mipmap",repeat:!0});s.load(t.fragment,t.vertex),h.load(t.uniforms),s.setUniforms(h.uniforms())}function p(t){var e=r.offsetWidth,n=r.offsetHeight;i.style.width=e+"px",i.style.height=n+"px"}function y(){s.timer.paused?(o.pause=!1,s.play(),n.pause.querySelector("i").setAttribute("class","icon-pause")):(o.pause=!0,s.pause(),n.pause.querySelector("i").setAttribute("class","icon-play"))}function m(){e&&(e.style.visibility="hidden"),h.hide(),n.stats.setAttribute("class","btn btn-stats"),o.stats=!1}})}();
//# sourceMappingURL=app.min.js.map
