!function(){"use strict";function e(){}e.prototype={set:function(e){this.canvas=e},snapshot:function(){var e=this;if(e.queue)return e.queue.promise;return e.queue={},e.queue.promise=new Promise(function(t,r){e.queue.resolve=t,e.queue.reject=r}),e.queue.promise},snapshotRender:function(){var e=this;if(e.queue){for(var t=e.canvas.toDataURL("image/png"),r=atob(t.slice(22)),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);var i=new Blob([n],{type:"image/png"});e.queue.resolve({blob:i,extension:".png"}),e.queue=null}},record:function(){var e=this;{if("function"!=typeof window.MediaRecorder||!e.canvas||"function"!=typeof e.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(e.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1}try{var t={},r=[],n=e.canvas.captureStream(),o={mimeType:"video/webm"},i=new MediaRecorder(n,o);i.ondataavailable=function(i){if(i.data.size>0&&r.push(i.data),t.resolve){var a=new Blob(r,{type:o.mimeType});if(n){var s=n.getTracks()||[];s.forEach(function(e){e.stop(),n.removeTrack(e)})}n=null,e.recorder=null,e.capture=null,t.resolve({blob:a,extension:".webm"})}},e.capture=t,e.recorder=i,i.start()}catch(t){return e.capture=null,e.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0},stop:function(){var e=this;if(!e.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return e.capture.promise=new Promise(function(t,r){e.capture.resolve=t,e.capture.reject=r}),e.recorder.stop(),e.capture.promise}},window.CaptureService=e}(),function(){"use strict";var e=function(){function e(e){var t={2:["x","y"],3:["x","y","z"],4:["r","g","b","a"]}[e.length],r={};return e.filter(function(e,n){r[t[n]]=e}),r}function t(e,t){var r={};return e.filter(function(e,n){r[t+n]=e}),r}function r(e){return function(t){return e[t]}}return{set:function(r){var n={};for(var o in r){var i=r[o];if(Array.isArray(i))if(i.length>1)switch(typeof i[0]){case"number":i.length<5&&(n[o]=e(i));break;case"boolean":n[o]=t(i,"bool_");break;case"string":n[o]=t(i,"texture_");break;case"object":n[o]=t(i,"struct_")}else i.length&&(n[o]=i[0]);else void 0!==i&&null!==i&&(n[o]=i)}return n},get:function(e){var t={};for(var n in e){var o=e[n];switch(typeof o){case"function":break;case"number":case"boolean":case"string":t[n]=o;break;default:var i=Object.keys(o);t[n]=i.map(r(o))}}return t}}}(),t=function(){function t(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function r(e){return JSON.parse(JSON.stringify(e))}return t.prototype={load:function(t){var n=this,o=n.gui,i=n.locals,a=(s=t,u=i,JSON.stringify(s)!==JSON.stringify(u));var s,u;o&&a&&(n.closed=o.closed,o.destroy(),o=null);o||((o=new dat.GUI).closed=n.closed,n.gui=o,n.hidden?n.hide():n.show());if(a){i=r(t),n.locals=i;var c=e.set(t);c=function(e,t){e&&function e(t,r){for(var n in t)r.hasOwnProperty(n)&&("number"==typeof t[n]?t[n]=r[n]:"object"==typeof t[n]&&Object.keys(t[n]).length>0&&e(t[n],r[n]))}(e=r(e),t);return e}(c,n.pool),n.pool=c;var l=function(){n.callback(c)};!function e(t,r,n){var o,i=[];for(o in r)i.push(o);i.filter(function(i){var a=r[i];if("number"==typeof a)(o=t.add(r,i,0,1)).onChange(n);else if("object"==typeof a&&Object.keys(a).length>0){o=null;var s=t.addFolder(i);e(s,a,n)}else(o=t.add(r,i)).onChange(n)})}(o,c,l),c.randomize=function(){!function(e,t,r){(function e(t,r){t.__controllers.filter(function(e){if("number"==typeof e.initialValue&&"number"==typeof e.__min&&"number"==typeof e.__max){var t=e.__min+(e.__max-e.__min)*Math.random();r[e.property]=t,e.updateDisplay()}});for(var n in t.__folders)e(t.__folders[n],r[n])})(e,t),r()}(o,c,l)},o.add(c,"randomize")}},hide:function(){this.gui.domElement.style.display="none",this.hidden=!0},show:function(){var e=this.locals;if(Object.keys(e).length){var t=this.gui;t.domElement.style.display=""}this.hidden=!1},uniforms:function(){var t=this.pool;return e.get(t)}},t}();window.GuiService=t}(),function(){"use strict";var e=function(){function e(){this.mouse=new Float32Array([0,0]),this.history=[],this.trails=new Array(10).fill(null).map(function(){return new Float32Array([0,0])})}e.prototype={render:function(e){var t=this.trails,r=this.history,n=this.mouse,o=0,i=t.length,a=r.length?r[0]:n;for(;o<i;){var s=o>0?t[o-1]:a,u=t[o],c=1/(5+o);u[0]+=(s[0]-u[0])*c,u[1]+=(s[1]-u[1])*c,this.update(e,"2fv","vec2","u_trails["+o+"]",u),o++}r.length&&r.shift()},move:function(e,t){var r=this.mouse;r[0]=e,r[1]=t,this.push()},push:function(e,r,n){var o,i,a,s=null,u=0;n||(n={});var c=function(){u=!1===n.leading?0:t(),s=null,a=e.apply(o,i),s||(o=i=null)};return function(){var l=t();u||!1!==n.leading||(u=l);var d=r-(l-u);return o=this,i=arguments,d<=0||d>r?(s&&(clearTimeout(s),s=null),u=l,a=e.apply(o,i),s||(o=i=null)):s||!1===n.trailing||(s=setTimeout(c,d)),a}}(function(){this.history.push(new Float32Array(this.mouse))},1e3/60),update:function(e,t,r,n,o){try{var i=e.uniforms[n]=e.uniforms[n]||{};i.name=n,i.value=o,i.type=r,i.method="uniform"+t,i.location=e.gl.getUniformLocation(e.program,n),e.gl[i.method].apply(e.gl,[i.location].concat(i.value))}catch(e){console.log("fastUpdate",e)}}};var t=Date.now||function(){return(new Date).getTime()};return e}();window.TrailsService=e}(),function(){"use strict";function e(e){var t=window.options,r=[],n=[];e.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,n,o,i){var a="ERROR ("+o+") "+i,s='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(n),a]))+'"><span class="line">ERROR line '+Number(n)+'</span> <span class="value" title="'+o+'">'+o+'</span> <span class="text" title="'+i+'">'+i+"</span></a></li>";return r.push(s),s}),e.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(r,o,i,a){var s='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(o),e]))+'"><span class="line">WARN line '+Number(o)+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return n.push(s),s});var o='<div class="errors-content"><p>glslCanvas error</p><ul>';o+=r.join("\n"),o+=n.join("\n"),o+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=o}window.addEventListener("load",function(){var t,r,n=document.querySelector(".content"),o=document.querySelector(".shader"),i={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},a={toggle:!1,record:!1,stats:!1};m(!0);var s=new GlslCanvas(o,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});s.on("error",e);var u=new CaptureService;u.set(o);var c=new TrailsService;function l(e){var t=f.uniforms();s.setUniforms(t)}s.on("render",function(){u.snapshotRender(),c.render(s),s.forceRender=!0});var d,f=new GuiService(l);function p(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var e=window.options;for(var t in e.vertex=e.vertex.trim().length>0?e.vertex:null,e.fragment=e.fragment.trim().length>0?e.fragment:null,s.load(e.fragment,e.vertex),e.textures)s.uniformTexture("u_texture_"+t,e.textures[t],{filtering:"mipmap",repeat:!0});f.load(e.uniforms),s.setUniforms(f.uniforms()),e.fragment||e.vertex?document.querySelector("body").setAttribute("class","ready"):(document.querySelector("body").setAttribute("class","empty"),h())}function m(e){var t=n.offsetWidth,r=n.offsetHeight;o.style.width=t+"px",o.style.height=r+"px",e?(o.width=t,o.height=r):s.resize()}function v(){a.pause=!a.pause,s.paused?(s.timePause&&(s.timePrev=new Date,s.timeLoad+=s.timePrev-s.timePause),s.play(),i.pause.querySelector("i").setAttribute("class","icon-pause")):(s.pause(),s.timePause=new Date,i.pause.querySelector("i").setAttribute("class","icon-play"))}function h(){r&&(r.style.visibility="hidden"),f.hide(),i.stats.setAttribute("class","btn btn-stats"),a.stats=!1}p(),o.addEventListener("dblclick",v),o.addEventListener("mousemove",function(e){c.move(e.x,n.offsetHeight-e.y)}),i.pause.addEventListener("mousedown",v),i.record.addEventListener("mousedown",function(){a.record=!a.record,a.record?(i.record.setAttribute("class","btn btn-record active"),i.record.querySelector("i").setAttribute("class","icon-stop"),s.forceRender=!0,s.render(),u.record()):(i.record.setAttribute("class","btn btn-record"),i.record.querySelector("i").setAttribute("class","icon-record"),u.stop().then(function(e){var t=URL.createObjectURL(e.blob),r=document.createElement("a");r.href=t,r.download="shader"+e.extension,r.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)}))}),i.stats.addEventListener("mousedown",function(){a.stats=!a.stats,a.stats?(r?r.style.visibility="visible":((t=new Stats).showPanel(0),r=t.dom,document.body.appendChild(t.dom)),requestAnimationFrame(function e(){t.update(),a.stats&&requestAnimationFrame(e)}),f.show(),i.stats.setAttribute("class","btn btn-stats active")):h()}),i.create.addEventListener("click",function(e){window.parent.postMessage({command:"did-click-link",data:"command:glsl-canvas.createShader?"+JSON.stringify([options.uri])},"file://")}),window.addEventListener("message",function(e){window.options=JSON.parse(e.data),p()},!1),window.addEventListener("resize",function(){d&&clearTimeout(d),d=setTimeout(m,50)}),m()})}();
//# sourceMappingURL=app.min.js.map
