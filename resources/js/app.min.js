!function(){"use strict";function e(){}e.prototype={set:function(e){this.canvas=e},snapshot:function(){var e=this;if(e.queue)return e.queue.promise;return e.queue={},e.queue.promise=new Promise(function(t,r){e.queue.resolve=t,e.queue.reject=r}),e.queue.promise},snapshotRender:function(){var e=this;if(e.queue){for(var t=e.canvas.toDataURL("image/png"),r=atob(t.slice(22)),n=new Uint8Array(r.length),o=0;o<r.length;++o)n[o]=r.charCodeAt(o);var s=new Blob([n],{type:"image/png"});e.queue.resolve({blob:s,extension:".png"}),e.queue=null}},record:function(){var e=this;{if("function"!=typeof window.MediaRecorder||!e.canvas||"function"!=typeof e.canvas.captureStream)return console.log("warn: Video capture (Canvas.captureStream and/or MediaRecorder APIs) not supported by browser"),!1;if(e.capture)return console.log("warn: Video capture already in progress, call Scene.stopVideoCapture() first"),!1}try{var t={},r=[],n=e.canvas.captureStream(),o={mimeType:"video/webm"},s=new MediaRecorder(n,o);s.ondataavailable=function(s){if(s.data.size>0&&r.push(s.data),t.resolve){var a=new Blob(r,{type:o.mimeType});if(n){var i=n.getTracks()||[];i.forEach(function(e){e.stop(),n.removeTrack(e)})}n=null,e.recorder=null,e.capture=null,t.resolve({blob:a,extension:".webm"})}},e.capture=t,e.recorder=s,s.start()}catch(t){return e.capture=null,e.recorder=null,console.log("error: Scene video capture failed",t),!1}return!0},stop:function(){var e=this;if(!e.capture)return console.log("warn: No scene video capture in progress, call Scene.startVideoCapture() first"),Promise.resolve({});return e.capture.promise=new Promise(function(t,r){e.capture.resolve=t,e.capture.reject=r}),e.recorder.stop(),e.capture.promise}};window.CaptureService=e}(),function(){"use strict";function e(e){this.closed=!0,this.hidden=!0,this.callback=e||function(){console.log("GuiService.onChange")},this.pool={}}function t(e){return JSON.parse(JSON.stringify(e))}e.prototype={load:function(e){var r=this,n=r.gui,o=r.locals,s=(a=e,i=o,JSON.stringify(a)!==JSON.stringify(i));var a,i;n&&s&&(r.closed=n.closed,n.destroy(),n=null);n||((n=new dat.GUI).closed=r.closed,r.gui=n,r.hidden?r.hide():r.show());if(s){o=t(e),r.locals=o;var c=function(e,r){e&&function e(t,r){for(var n in t)r.hasOwnProperty(n)&&("number"==typeof t[n]?t[n]=r[n]:"object"==typeof t[n]&&Object.keys(t[n]).length>0&&e(t[n],r[n]))}(e=t(e),r);return e}(e,r.pool);r.pool=c,function e(t,r,n){var o,s=[];for(o in r)s.push(o);for(var a=0;a<s.length;a++){var i=s[a];if("number"==typeof r[i])(o=t.add(r,i,.5*r[i],2*r[i])).onChange(n);else if("object"==typeof r[i]&&Object.keys(r[i]).length>0){o=null;var c=t.addFolder(i);e(c,r[i],n)}else(o=t.add(r,i)).onChange(n)}}(n,c,r.callback),r.callback()}},hide:function(){this.gui.domElement.style.display="none",this.hidden=!0},show:function(){var e=this.locals;if(Object.keys(e).length){var t=this.gui;t.domElement.style.display=""}this.hidden=!1},getParams:function(){return this.pool}},window.GuiService=e}(),function(){"use strict";function e(e){var t=window.options,r=[],n=[];e.error.replace(/ERROR: \d+:(\d+): \'(.+)\' : (.+)/g,function(e,n,o,s){var a="ERROR ("+o+") "+s,i='<li><a class="error" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(n),a]))+'"><span class="line">ERROR line '+Number(n)+'</span> <span class="value" title="'+o+'">'+o+'</span> <span class="text" title="'+s+'">'+s+"</span></a></li>";return r.push(i),i}),e.error.replace(/WARNING: \d+:(\d+): \'(.*\n*|.*|\n*)\' : (.+)/g,function(r,o,s,a){var i='<li><a class="warning" unselectable href="'+encodeURI("command:glsl-canvas.revealGlslLine?"+JSON.stringify([t.uri,Number(o),e]))+'"><span class="line">WARN line '+Number(o)+'</span> <span class="text" title="'+a+'">'+a+"</span></a></li>";return n.push(i),i});var o='<div class="errors-content"><p>glslCanvas error</p><ul>';o+=r.join("\n"),o+=n.join("\n"),o+="</ul></div>",document.querySelector(".errors").setAttribute("class","errors active"),document.querySelector(".errors").innerHTML=o}window.addEventListener("load",function(){var t,r,n=document.querySelector(".content"),o=document.querySelector(".shader"),s={pause:document.querySelector(".btn-pause"),record:document.querySelector(".btn-record"),stats:document.querySelector(".btn-stats"),create:document.querySelector(".btn-create")},a={toggle:!1,record:!1,stats:!1};p(!0);var i=new GlslCanvas(o,{premultipliedAlpha:!1,preserveDrawingBuffer:!0,backgroundColor:"rgba(1,1,1,1)"});i.on("error",e);var c=new CaptureService;c.set(o),i.on("render",function(){c.snapshotRender()});var u,l=new GuiService(function(){var e=l.getParams();for(var t in e)i.setUniform(t,e[t])});function d(){document.querySelector(".errors").setAttribute("class","errors"),document.querySelector(".welcome").setAttribute("class",options.uri?"welcome":"welcome active");var e=window.options;for(var t in e.vertex=e.vertex.trim().length>0?e.vertex:null,e.fragment=e.fragment.trim().length>0?e.fragment:null,i.load(e.fragment,e.vertex),l.load(e.uniforms),e.textures)i.setUniform("u_texture_"+t,e.textures[t]);document.querySelector("body").setAttribute("class",e.fragment||e.vertex?"ready":"empty")}function p(e){var t=n.offsetWidth,r=n.offsetHeight;o.style.width=t+"px",o.style.height=r+"px",e?(o.width=t,o.height=r):i.resize()}function f(){a.pause=!a.pause,i.paused?(i.timePause&&(i.timePrev=new Date,i.timeLoad+=i.timePrev-i.timePause),i.play(),s.pause.querySelector("i").setAttribute("class","icon-pause")):(i.pause(),i.timePause=new Date,s.pause.querySelector("i").setAttribute("class","icon-play"))}d(),o.addEventListener("dblclick",f),s.pause.addEventListener("mousedown",f),s.record.addEventListener("mousedown",function(){a.record=!a.record,a.record?(s.record.setAttribute("class","btn btn-record active"),s.record.querySelector("i").setAttribute("class","icon-stop"),i.forceRender=!0,i.render(),c.record()):(s.record.setAttribute("class","btn btn-record"),s.record.querySelector("i").setAttribute("class","icon-record"),c.stop().then(function(e){var t=URL.createObjectURL(e.blob),r=document.createElement("a");r.href=t,r.download="shader"+e.extension,r.click(),setTimeout(function(){window.URL.revokeObjectURL(output)},100)}))}),s.stats.addEventListener("mousedown",function(){a.stats=!a.stats,a.stats?(r?r.style.visibility="visible":((t=new Stats).showPanel(0),r=t.dom,document.body.appendChild(t.dom)),requestAnimationFrame(function e(){t.update(),a.stats&&requestAnimationFrame(e)}),l.show(),s.stats.setAttribute("class","btn btn-stats active")):(r&&(r.style.visibility="hidden"),l.hide(),s.stats.setAttribute("class","btn btn-stats"))}),s.create.addEventListener("click",function(e){window.parent.postMessage({command:"did-click-link",data:"command:glsl-canvas.createShader?"+JSON.stringify([options.uri])},"file://")}),window.addEventListener("message",function(e){window.options=JSON.parse(e.data),d()},!1),window.addEventListener("resize",function(){u&&clearTimeout(u),u=setTimeout(p,50)}),p()})}();
//# sourceMappingURL=app.min.js.map
