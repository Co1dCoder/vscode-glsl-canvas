{"version":3,"sources":["resources/app.js"],"names":["onLoad","load","document","querySelector","setAttribute","options","uri","o","window","vertex","trim","length","fragment","glsl","u","uniforms","setUniform","t","textures","onResize","w","content","offsetWidth","h","offsetHeight","canvas","style","width","height","togglePause","flags","pause","paused","timePause","timePrev","Date","timeLoad","play","buttons","toggleRecord","record","encoder","Whammy","Video","add","getContext","e","console","log","compile","output","blob","webkitURL","URL","createObjectURL","link","createElement","href","download","click","setTimeout","revokeObjectURL","toggleStats","statsTick","stats","update","requestAnimationFrame","statsdom","visibility","Stats","showPanel","dom","cssText","body","appendChild","createShader","parent","postMessage","command","data","JSON","stringify","onMessage","event","parse","create","toggle","GlslCanvas","on","onGlslError","addEventListener","message","errors","warnings","error","replace","m","l","v","li","Number","encodeURI","push","join","innerHTML","querySelectorAll"],"mappings":"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","file":"resources/app.min.js","sourcesContent":["/* global window, document, console, GlslCanvas */\n\n(function () {\n    'use strict';\n\n    function onLoad() {\n        var o = 1;\n\n        var content = document.querySelector('.content');\n        var canvas = document.querySelector('.shader');\n        var buttons = {\n            pause: document.querySelector('.btn-pause'),\n            record: document.querySelector('.btn-record'),\n            stats: document.querySelector('.btn-stats'),\n            create: document.querySelector('.btn-create'),\n        };\n        var flags = {\n            toggle: false,\n            record: false,\n            stats: false,\n        };\n\n        onResize();\n\n        var glsl = new GlslCanvas(canvas);\n        glsl.on('error', onGlslError);\n\n        load();\n\n        function load() {\n            document.querySelector('.errors').setAttribute('class', 'errors');\n            document.querySelector('.welcome').setAttribute('class', (options.uri ? 'welcome' : 'welcome active'));\n            var o = window.options;\n            o.vertex = o.vertex.trim().length > 0 ? o.vertex : null;\n            o.fragment = o.fragment.trim().length > 0 ? o.fragment : null;\n            glsl.load(o.fragment, o.vertex);\n            for (var u in o.uniforms) {\n                glsl.setUniform(u, o.uniforms[u]);\n            }\n            for (var t in o.textures) {\n                glsl.setUniform('u_texture_' + t, o.textures[t]);\n            }\n            document.querySelector('body').setAttribute('class', (o.fragment || o.vertex ? 'ready' : 'empty'));\n        }\n\n        function onResize() {\n            var w = content.offsetWidth + o;\n            var h = content.offsetHeight + o;\n            canvas.style.width = w + 'px';\n            canvas.style.height = h + 'px';\n            canvas.width = w;\n            canvas.height = h;\n            o = 0;\n        }\n\n        function togglePause() {\n            flags.pause = !flags.pause;\n            // console.log('pause', flags.pause);\n            if (glsl.paused) {\n                if (glsl.timePause) {\n                    glsl.timePrev = new Date();\n                    glsl.timeLoad += (glsl.timePrev - glsl.timePause);\n                }\n                glsl.play();\n                buttons.pause.querySelector('i').setAttribute('class', 'icon-pause');\n            } else {\n                glsl.pause();\n                glsl.timePause = new Date();\n                buttons.pause.querySelector('i').setAttribute('class', 'icon-play');\n            }\n        }\n\n        var encoder;\n\n        function toggleRecord() {\n            flags.record = !flags.record;\n            // console.log('record', flags.record);\n            if (flags.record) {\n                buttons.record.querySelector('i').setAttribute('class', 'icon-stop');\n                try {\n                    encoder = new Whammy.Video(20);\n                    canvas = document.querySelector('.shader');\n                    // canvas.crossOrigin = 'anonymous';\n                    encoder.add(canvas.getContext(\"webgl\")); // , 10 * 1000); // ten sec\n                } catch (e) {\n                    console.log('encoder.init.error', e);\n                }\n            } else {\n                buttons.record.querySelector('i').setAttribute('class', 'icon-record');\n                try {\n                    if (encoder) {\n                        encoder.compile(function (output) {\n                            var blob = (window.webkitURL || window.URL).createObjectURL(output);\n                            var link = document.createElement('a');\n                            link.href = blob;\n                            link.download = \"shader.webm\";\n                            link.click();\n                            setTimeout(function () {\n                                (window.webkitURL || window.URL).revokeObjectURL(output);\n                            }, 100);\n                        });\n                        encoder = null;\n                    }\n                } catch (e) {\n                    console.log('encoder.compile.error', e);\n                }\n            }\n        }\n\n        var stats, statsdom;\n\n        function toggleStats() {\n            flags.stats = !flags.stats;\n\n            function statsTick() {\n                stats.update();\n                if (flags.stats) {\n                    requestAnimationFrame(statsTick);\n                }\n            }\n            if (flags.stats) {\n                if (!statsdom) {\n                    stats = new Stats();\n                    stats.showPanel(0); // 0: fps, 1: ms, 2: mb, 3+: custom\n                    statsdom = stats.dom;\n                    statsdom.style.cssText = 'position:fixed;top:0;right:0;cursor:pointer;opacity:0.9;z-index:10000';\n                    document.body.appendChild(stats.dom);\n                } else {\n                    statsdom.style.visibility = 'visible';\n                }\n                requestAnimationFrame(statsTick);\n                buttons.stats.setAttribute('class', 'btn active');\n            } else {\n                if (statsdom) {\n                    statsdom.style.visibility = 'hidden';\n                }\n                buttons.stats.setAttribute('class', 'btn');\n            }\n        }\n\n        function createShader(e) {\n            console.log('createShader', e);\n            window.parent.postMessage({\n                command: \"did-click-link\",\n                data: 'command:glsl-canvas.createShader?' + JSON.stringify([options.uri]),\n            }, \"file://\");\n        }\n\n        function onMessage(event) {\n            window.options = JSON.parse(event.data);\n            // console.log('onMessage', window.options);\n            // event.source.postMessage('message', event.origin);\n            load();\n        }\n\n        document.addEventListener(\"dblclick\", togglePause);\n        buttons.pause.addEventListener('mousedown', togglePause);\n        buttons.record.addEventListener('mousedown', toggleRecord);\n        buttons.stats.addEventListener('mousedown', toggleStats);\n        buttons.create.addEventListener('click', createShader);\n        window.addEventListener(\"message\", onMessage, false);\n        window.addEventListener('resize', onResize);\n        onResize();\n    }\n\n    function onGlslError(message) {\n        // console.log('onGlslError.error', message.error);\n        var options = window.options;\n        var errors = [],\n            warnings = [];\n        message.error.replace(/ERROR: \\d+:(\\d+): \\'(.+)\\' : (.+)/g, function (m, l, v, t) {\n            var message = 'ERROR (' + v + ') ' + t;\n            var li = '<li><a class=\"error\" unselectable data-line=\"' + Number(l) + '\" href=\"' + encodeURI('command:glsl-canvas.revealGlslLine?' + JSON.stringify([options.uri, Number(l), message])) + '\"><span class=\"line\">ERROR line ' + Number(l) + '</span> <span class=\"value\" title=\"' + v + '\">' + v + '</span> <span class=\"text\" title=\"' + t + '\">' + t + '</span></a></li>';\n            errors.push(li);\n            return li;\n        });\n        message.error.replace(/WARNING: \\d+:(\\d+): \\'(.*\\n*|.*|\\n*)\\' : (.+)/g, function (m, l, v, t) {\n            var li = '<li><a class=\"warning\" unselectable data-line=\"' + Number(l) + '\" href=\"' + encodeURI('command:glsl-canvas.revealGlslLine?' + JSON.stringify([options.uri, Number(l), message])) + '\"><span class=\"line\">WARN line ' + Number(l) + '</span> <span class=\"text\" title=\"' + t + '\">' + t + '</span></a></li>';\n            warnings.push(li);\n            return li;\n        });\n        var output = '<div class=\"errors-content\"><h4>glslCanvas error</h4><ul>';\n        output += errors.join('\\n');\n        output += warnings.join('\\n');\n        output += '</ul></div>';\n        document.querySelector('.errors').setAttribute('class', 'errors active');\n        document.querySelector('.errors').innerHTML = output;\n        if (errors.length) {\n            document.querySelectorAll('.error')[0].click();\n        }\n    }\n    window.addEventListener('load', onLoad);\n}());"],"sourceRoot":"/source/"}