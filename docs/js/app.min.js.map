{"version":3,"sources":["docs/js/app.js"],"names":["TrailsService","service","this","mouse","Float32Array","history","trails","Array","fill","map","prototype","render","glsl","i","t","length","tx","e","v","friction","update","shift","move","x","y","push","func","wait","options","context","args","result","timeout","previous","later","leading","getNow","apply","now","remaining","arguments","clearTimeout","trailing","setTimeout","throttle","method","type","name","value","u","uniforms","location","gl","getUniformLocation","program","concat","console","log","Date","getTime","window","frag_header","getResource","url","callback","request","XMLHttpRequest","open","addEventListener","responseText","send","data","nodes","document","querySelectorAll","array","scope","call","forEach","node","qso","list","dict","kv","split","decodeURIComponent","replace","search","substr","resource","innerHTML","editor","GlslEditor","canvas_size","canvas_draggable","fileDrops","menu","multipleBuffers","theme","watchHash","shader","canvas","uniformTexture","filtering","repeat","on","forceRender","el","offsetLeft","offsetTop","offsetHeight"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global window, document, console */\n\n(function () {\n    'use strict';\n\n    var TrailsService = function () {\n\n        function TrailsService() {\n            var service = this;\n            service.mouse = new Float32Array([0.0, 0.0]);\n            service.history = [];\n            service.trails = new Array(10).fill(null).map(function () {\n                return new Float32Array([0.0, 0.0]);\n            });\n        }\n\n        TrailsService.prototype = {\n            render: render,\n            move: move,\n            push: throttle(_push, 1000 / 60),\n            update: update,\n        };\n\n        // statics\n\n        var getNow = Date.now || function () {\n            return new Date().getTime();\n        };\n\n        function throttle(func, wait, options) {\n            // Returns a function, that, when invoked, will only be triggered at most once\n            // during a given window of time. Normally, the throttled function will run\n            // as much as it can, without ever going more than once per `wait` duration;\n            // but if you'd like to disable the execution on the leading edge, pass\n            // `{leading: false}`. To disable execution on the trailing edge, ditto.\n            var context, args, result;\n            var timeout = null;\n            var previous = 0;\n            if (!options) options = {};\n            var later = function () {\n                previous = options.leading === false ? 0 : getNow();\n                timeout = null;\n                result = func.apply(context, args);\n                if (!timeout) context = args = null;\n            };\n            return function () {\n                var now = getNow();\n                if (!previous && options.leading === false) previous = now;\n                var remaining = wait - (now - previous);\n                context = this;\n                args = arguments;\n                if (remaining <= 0 || remaining > wait) {\n                    if (timeout) {\n                        clearTimeout(timeout);\n                        timeout = null;\n                    }\n                    previous = now;\n                    result = func.apply(context, args);\n                    if (!timeout) context = args = null;\n                } else if (!timeout && options.trailing !== false) {\n                    timeout = setTimeout(later, remaining);\n                }\n                return result;\n            };\n        }\n\n        // publics\n\n        var ti = 0;\n\n        function render(glsl) {\n            var service = this;\n            var trails = service.trails,\n                history = service.history,\n                mouse = service.mouse;\n\n            var i = 0,\n                t = trails.length;\n            var tx = history.length ? history[0] : mouse;\n            while (i < t) {\n                var e = (i > 0 ? trails[i - 1] : tx);\n                var v = trails[i];\n                var friction = 1.0 / (5.0 + i);\n                v[0] += (e[0] - v[0]) * friction;\n                v[1] += (e[1] - v[1]) * friction;\n                service.update(glsl, '2fv', 'vec2', 'u_trails[' + i + ']', v);\n                i++;\n            }\n            if (history.length) {\n                history.shift();\n            }\n            /*\n            var d = trails[0];\n            if (history.length && Math.abs(d.x - tx.x) < 2 && Math.abs(d.y - tx.y) < 2) {\n                history.shift();\n            }\n            */\n            /*\n            ti++;\n            if (ti % 10 === 0 && history.length > 0) {\n                history.shift();\n            }\n            */\n            /*\n            fastUpdate('2fv', 'vec2', 'u_trails[10]', trails);\n            console.log('parseUniforms', parseUniforms({\n                u_trails: value\n            }));\n            */\n            // onUpdateUniforms();\n            // uniforms.u_trails = trails;\n            // glsl.setUniform('u_trails', trails);\n            // console.log('onUpdateUniforms', trails[0][0], trails[0][1]);\n        }\n\n        function move(x, y) {\n            var service = this,\n                mouse = service.mouse;\n            mouse[0] = x;\n            mouse[1] = y;\n            service.push();\n        }\n\n        function _push() {\n            var service = this;\n            service.history.push(new Float32Array(service.mouse));\n        }\n\n        function update(glsl, method, type, name, value) {\n            try {\n                var u = glsl.uniforms[name] = glsl.uniforms[name] || {};\n                u.name = name;\n                u.value = value;\n                u.type = type;\n                u.method = 'uniform' + method;\n                u.location = glsl.gl.getUniformLocation(glsl.program, name);\n                glsl.gl[u.method].apply(glsl.gl, [u.location].concat(u.value));\n            } catch (e) {\n                console.log('fastUpdate', e);\n            }\n        }\n\n        return TrailsService;\n    }();\n\n    window.TrailsService = TrailsService;\n\n}());\n/* global window, document, console, GlslCanvas, CaptureService, Stats, dat */\n\n(function () {\n    'use strict';\n\n    var trails = new TrailsService();\n\n    init();\n\n    function init() {\n        var frag_header = '';\n        getResource(\"playgrounds/lib.glsl\", function (data) {\n            frag_header = data;\n            var nodes = document.querySelectorAll('code');\n            forEach(nodes, function (i, node) {\n                // console.log(node.getAttribute('data'));                \n                // var resource = node.getAttribute('data');\n                var qso = getQuerystring();\n                var resource = qso.glsl || 'animation';\n                getResource('playgrounds/' + resource + '.glsl', function (data) {\n                    node.innerHTML = data;\n                    var editor = new GlslEditor(node, {\n                        canvas_size: 400,\n                        canvas_draggable: true,\n                        fileDrops: false,\n                        frag_header: frag_header,\n                        menu: false,\n                        multipleBuffers: false,\n                        theme: 'monokai',\n                        watchHash: false,\n                    });\n                    // console.log('editor', editor);\n                    var glsl = editor.shader.canvas;\n                    glsl.uniformTexture('u_texture_0', 'https://rawgit.com/actarian/plausible-brdf-shader/master/textures/noise/cloud-1.png', {\n                        filtering: 'mipmap',\n                        repeat: true,\n                    });\n                    glsl.on('render', function () {\n                        trails.render(glsl);\n                        glsl.forceRender = true;\n                    });\n                    glsl.canvas.addEventListener('mousemove', function onMove(e) {\n                        trails.move(e.x - editor.shader.el.offsetLeft, editor.shader.el.offsetTop + editor.shader.el.offsetHeight - e.y);\n                    });\n                });\n            });\n        });\n    }\n\n    function forEach(array, callback, scope) {\n        for (var i = 0; i < array.length; i++) {\n            callback.call(scope, i, array[i]); // passes back stuff we need\n        }\n    }\n\n    function getResource(url, callback) {\n        var request = new XMLHttpRequest();\n        request.open('GET', url, true);\n        request.addEventListener('load', function () {\n            callback(request.responseText);\n        });\n        request.send();\n    }\n\n    function getQuerystring() {\n        var q = (function (list) {\n            if (list == '') return {};\n            var dict = {};\n            for (var i = 0; i < list.length; ++i) {\n                var kv = list[i].split('=', 2);\n                if (kv.length == 1) {\n                    dict[kv[0]] = '';\n                }\n                else {\n                    dict[kv[0]] = decodeURIComponent(kv[1].replace(/\\+/g, ' '));\n                }\n            }\n            return dict;\n        })(window.location.search.substr(1).split('&'));\n        return q;\n    }\n\n}());"]}