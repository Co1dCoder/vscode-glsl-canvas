{"version":3,"sources":["docs/js/docs.js"],"names":["TrailsService","service","this","mouse","Float32Array","history","trails","Array","fill","map","render","glsl","i","t","length","tx","e","v","friction","update","shift","move","x","y","push","_push","method","type","name","value","u","uniforms","location","gl","getUniformLocation","program","apply","concat","console","log","prototype","func","wait","options","context","args","result","timeout","previous","later","leading","getNow","now","remaining","arguments","clearTimeout","trailing","setTimeout","Date","getTime","window","getResource","url","callback","request","XMLHttpRequest","open","addEventListener","responseText","send","getQuerystring","list","dict","kv","split","decodeURIComponent","replace","search","substr","frag_header","data","editorNode","document","querySelector","innerHTML","editor","GlslEditor","canvas_size","canvas_draggable","fileDrops","menu","multipleBuffers","theme","watchHash","shader","canvas","uniformTexture","filtering","repeat","on","forceRender","el","offsetLeft","offsetTop","offsetHeight"],"mappings":"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","file":"docs/js/docs.min.js","sourcesContent":["/* global window, document, console */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var TrailsService = function () {\r\n\r\n        function TrailsService() {\r\n            var service = this;\r\n            service.mouse = new Float32Array([0.0, 0.0]);\r\n            service.history = [];\r\n            service.trails = new Array(10).fill(null).map(function () {\r\n                return new Float32Array([0.0, 0.0]);\r\n            });\r\n        }\r\n\r\n        TrailsService.prototype = {\r\n            render: render,\r\n            move: move,\r\n            push: throttle(_push, 1000 / 60),\r\n            update: update,\r\n        };\r\n\r\n        // statics\r\n\r\n        var getNow = Date.now || function () {\r\n            return new Date().getTime();\r\n        };\r\n\r\n        function throttle(func, wait, options) {\r\n            // Returns a function, that, when invoked, will only be triggered at most once\r\n            // during a given window of time. Normally, the throttled function will run\r\n            // as much as it can, without ever going more than once per `wait` duration;\r\n            // but if you'd like to disable the execution on the leading edge, pass\r\n            // `{leading: false}`. To disable execution on the trailing edge, ditto.\r\n            var context, args, result;\r\n            var timeout = null;\r\n            var previous = 0;\r\n            if (!options) options = {};\r\n            var later = function () {\r\n                previous = options.leading === false ? 0 : getNow();\r\n                timeout = null;\r\n                result = func.apply(context, args);\r\n                if (!timeout) context = args = null;\r\n            };\r\n            return function () {\r\n                var now = getNow();\r\n                if (!previous && options.leading === false) previous = now;\r\n                var remaining = wait - (now - previous);\r\n                context = this;\r\n                args = arguments;\r\n                if (remaining <= 0 || remaining > wait) {\r\n                    if (timeout) {\r\n                        clearTimeout(timeout);\r\n                        timeout = null;\r\n                    }\r\n                    previous = now;\r\n                    result = func.apply(context, args);\r\n                    if (!timeout) context = args = null;\r\n                } else if (!timeout && options.trailing !== false) {\r\n                    timeout = setTimeout(later, remaining);\r\n                }\r\n                return result;\r\n            };\r\n        }\r\n\r\n        // publics\r\n\r\n        var ti = 0;\r\n\r\n        function render(glsl) {\r\n            var service = this;\r\n            var trails = service.trails,\r\n                history = service.history,\r\n                mouse = service.mouse;\r\n\r\n            var i = 0,\r\n                t = trails.length;\r\n            var tx = history.length ? history[0] : mouse;\r\n            while (i < t) {\r\n                var e = (i > 0 ? trails[i - 1] : tx);\r\n                var v = trails[i];\r\n                var friction = 1.0 / (5.0 + i);\r\n                v[0] += (e[0] - v[0]) * friction;\r\n                v[1] += (e[1] - v[1]) * friction;\r\n                service.update(glsl, '2fv', 'vec2', 'u_trails[' + i + ']', v);\r\n                i++;\r\n            }\r\n            if (history.length) {\r\n                history.shift();\r\n            }\r\n        }\r\n\r\n        function move(x, y) {\r\n            var service = this,\r\n                mouse = service.mouse;\r\n            mouse[0] = x;\r\n            mouse[1] = y;\r\n            service.push();\r\n        }\r\n\r\n        function _push() {\r\n            var service = this;\r\n            service.history.push(new Float32Array(service.mouse));\r\n        }\r\n\r\n        function update(glsl, method, type, name, value) {\r\n            try {\r\n                var u = glsl.uniforms[name] = glsl.uniforms[name] || {};\r\n                u.name = name;\r\n                u.value = value;\r\n                u.type = type;\r\n                u.method = 'uniform' + method;\r\n                u.location = glsl.gl.getUniformLocation(glsl.program, name);\r\n                glsl.gl[u.method].apply(glsl.gl, [u.location].concat(u.value));\r\n            } catch (e) {\r\n                console.log('fastUpdate', e);\r\n            }\r\n        }\r\n\r\n        return TrailsService;\r\n    }();\r\n\r\n    window.TrailsService = TrailsService;\r\n\r\n}());\n/* global window, document, console, GlslEditor, TrailsService */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var trails = new TrailsService();\r\n\r\n    init();\r\n\r\n    function init() {\r\n        var frag_header = '';\r\n        getResource(\"playgrounds/lib.glsl\", function (data) {\r\n            frag_header = data;\r\n            var qso = getQuerystring();\r\n            var resource = qso.glsl || 'main';\r\n            getResource('playgrounds/' + resource + '.glsl', function (data) {\r\n                var editorNode = document.querySelector('.editor');\r\n                editorNode.innerHTML = data;\r\n                var editor = new GlslEditor(editorNode, {\r\n                    canvas_size: 400,\r\n                    canvas_draggable: true,\r\n                    fileDrops: false,\r\n                    frag_header: frag_header,\r\n                    menu: false,\r\n                    multipleBuffers: false,\r\n                    theme: 'monokai',\r\n                    watchHash: false,\r\n                });\r\n                // console.log('editor', editor);\r\n                var glsl = editor.shader.canvas;\r\n                glsl.uniformTexture('u_texture_0', 'https://rawgit.com/actarian/plausible-brdf-shader/master/textures/noise/cloud-1.png', {\r\n                    filtering: 'mipmap',\r\n                    repeat: true,\r\n                });\r\n                glsl.on('render', function () {\r\n                    trails.render(glsl);\r\n                    glsl.forceRender = true;\r\n                });\r\n                glsl.canvas.addEventListener('mousemove', function onMove(e) {\r\n                    trails.move(e.x - editor.shader.el.offsetLeft, editor.shader.el.offsetTop + editor.shader.el.offsetHeight - e.y);\r\n                });\r\n            });\r\n            // var nodes = document.querySelectorAll('code');\r\n            // forEach(nodes, function (i, node) { });\r\n        });\r\n    }\r\n\r\n    function forEach(array, callback, scope) {\r\n        for (var i = 0; i < array.length; i++) {\r\n            callback.call(scope, i, array[i]); // passes back stuff we need\r\n        }\r\n    }\r\n\r\n    function getResource(url, callback) {\r\n        var request = new XMLHttpRequest();\r\n        request.open('GET', url, true);\r\n        request.addEventListener('load', function () {\r\n            callback(request.responseText);\r\n        });\r\n        request.send();\r\n    }\r\n\r\n    function getQuerystring() {\r\n        var q = (function (list) {\r\n            if (list == '') return {};\r\n            var dict = {};\r\n            for (var i = 0; i < list.length; ++i) {\r\n                var kv = list[i].split('=', 2);\r\n                if (kv.length == 1) {\r\n                    dict[kv[0]] = '';\r\n                } else {\r\n                    dict[kv[0]] = decodeURIComponent(kv[1].replace(/\\+/g, ' '));\r\n                }\r\n            }\r\n            return dict;\r\n        })(window.location.search.substr(1).split('&'));\r\n        return q;\r\n    }\r\n\r\n}());"],"sourceRoot":"/source/"}